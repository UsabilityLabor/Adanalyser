<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of Plotter</title>
  <meta name="keywords" content="Plotter">
  <meta name="description" content="Performs different plots">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- menu.html AdAnalyzerSoftware -->
<h1>Plotter
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>Performs different plots</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Performs different plots
   Gets utilized by diffferent other functions
   Plots settings of the GUI
   Plots settings of the different stimulus
   Plots statistics 
   Plots valid/invalid tabel of subjects
   Plots 2D Topology Maps
   Plots Brain Activity 
   Plots quality figures and HRV/EDA figues

 Author: Gernot Heisenberg, Tim Kreitzberg</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="Data.html" class="code" title="">Data</a>	Representation of all data</li><li><a href="Device.html" class="code" title="">Device</a>	Representation of a complete device</li><li><a href="Plotter.html" class="code" title="">Plotter</a>	Performs different plots</li><li><a href="Subject.html" class="code" title="">Subject</a>	Data representation of all informations related to one subject</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="AnalyseAction.html" class="code" title="">AnalyseAction</a>	Performs analysis steps for valid subjects</li><li><a href="FilterAction.html" class="code" title="">FilterAction</a>	Performs filter calculation steps</li><li><a href="Plotter.html" class="code" title="">Plotter</a>	Performs different plots</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function writeSettings(self,config,eegDevice,edaDevice,hrvDevice,fName)</a></li><li><a href="#_sub2" class="code">function writeAdIndex(self,StimuInt,fName)</a></li><li><a href="#_sub3" class="code">function writeStatistics(self,stats,fName)</a></li><li><a href="#_sub4" class="code">function writeValid(self,index, fName)</a></li><li><a href="#_sub5" class="code">function writeCSV(self,fName,format,data)</a></li><li><a href="#_sub6" class="code">function printTopo(self,config,subject,EEG,StimuDef,electrodes)</a></li><li><a href="#_sub7" class="code">function stimulusOverviewChart(self,config,subject,EEG,StimuDef)</a></li><li><a href="#_sub8" class="code">function barsimg = plotElectrodeBars(self,electrodes,startpos,endpos,data,srate)</a></li><li><a href="#_sub9" class="code">function plotHRVRecurrence(self,subject,config,StimuIntName,hrvData,StimuIntDefs)</a></li><li><a href="#_sub10" class="code">function plotEDARecurrence(self,subject,config,StimuInt,edaData,edaDevice)</a></li><li><a href="#_sub11" class="code">function plotBehavioralCharacteristics(self,subjectName,StimuIntNum,outputDir,frequencies,StimuIntDef,eegDevice)</a></li><li><a href="#_sub12" class="code">function plotHRV(self,hrvValues,outputDir,subjName,StimuIntDef)</a></li><li><a href="#_sub13" class="code">function plotRawEEGFigures(self,rawValues,filteredValues,quality,subject,electrode,config)</a></li><li><a href="#_sub14" class="code">function plotSubStimuIntEDA(self,StimuIntIndex,edaValues,StimuIntDefs,subjectName,fPath,stats)</a></li><li><a href="#_sub15" class="code">function plotEDA(self,StimuIntDef,fPath,edaValues,detrended)</a></li><li><a href="#_sub16" class="code">function plotFrequencys(self,StimuIntLength,fPath,theta_s,alpha_s,beta1_s,beta2_s,task_s,resolution,StimuIntDef,edaSubStimuIntList)</a></li><li><a href="#_sub17" class="code">function plotFrequencysWithBaselineMagnitude(self,StimuIntLength,fPath,theta_s,alpha_s,beta1_s,beta2_s,task_s,baselineTheta,baselineAlpha,baselineBeta1,baselineBeta2,baselineTEI,resolution,intervals,t_title)</a></li><li><a href="#_sub18" class="code">function massAndTime = calculateMassAndTime(self,values,numDataPoints, mean)</a></li><li><a href="#_sub19" class="code">function [StimuIntStartPoints,StimuIntLabels,intervals,completeVidLength] = calculateStimuIntStartPointsAndIntervals(self,StimuIntDef)</a></li><li><a href="#_sub20" class="code">function plotIntervals(self,intervals,yPos,scaleFac,labels,color)</a></li><li><a href="#_sub21" class="code">function plotStimuIntStartPoints(self,startPoints,labels,yPos,scaleFac)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% Performs different plots</span>
0002 <span class="comment">%   Gets utilized by diffferent other functions</span>
0003 <span class="comment">%   Plots settings of the GUI</span>
0004 <span class="comment">%   Plots settings of the different stimulus</span>
0005 <span class="comment">%   Plots statistics</span>
0006 <span class="comment">%   Plots valid/invalid tabel of subjects</span>
0007 <span class="comment">%   Plots 2D Topology Maps</span>
0008 <span class="comment">%   Plots Brain Activity</span>
0009 <span class="comment">%   Plots quality figures and HRV/EDA figues</span>
0010 <span class="comment">%</span>
0011 <span class="comment">% Author: Gernot Heisenberg, Tim Kreitzberg</span>
0012 <span class="comment">%</span>
0013 
0014 
0015 classdef <a href="Plotter.html" class="code" title="">Plotter</a>
0016     methods
0017         
0018         <span class="comment">%% Saves all GUI and DEVICE settings to fName.pdf</span>
0019         <span class="comment">%   config: contains all configs as String</span>
0020         <span class="comment">%   fName: File name as String</span>
0021         <span class="comment">%   Devices: contains settings of different devices</span>
0022         <a name="_sub0" href="#_subfunctions" class="code">function writeSettings(self,config,eegDevice,edaDevice,hrvDevice,fName)</a>
0023             fatbraid=&quot;===========================================================&quot; + newline;
0024             thinbraid=&quot;------------------------------------------------------&quot; + newline;
0025             
0026             output_text= strcat(fatbraid,&quot;---&gt; GUI SETTINGS&quot;+newline);
0027             output_text= strcat(output_text,fatbraid);
0028             
0029             <span class="comment">% hardcoded structure of the settings sheet</span>
0030             <span class="comment">% each section gets seperated by a fat/thinbraid</span>
0031             output_text= strcat(output_text,thinbraid);
0032             output_text= strcat(output_text,&quot;<a href="Subject.html" class="code" title="">Subject</a> Settings&quot;+newline);
0033             output_text= strcat(output_text,thinbraid);
0034             output_text= strcat(output_text,&quot;Number of Subjects=&quot; + num2str(config.numSubjects)+newline+newline);
0035             
0036             output_text= strcat(output_text,thinbraid);
0037             output_text= strcat(output_text,&quot;Output Settings&quot;+newline);
0038             output_text= strcat(output_text,thinbraid);
0039             output_text= strcat(output_text,&quot;SubStimuIntEDAFig=&quot; + num2str(config.SubStimuIntEDAFig)+newline);
0040             output_text= strcat(output_text,&quot;Statistics=&quot; + num2str(config.Statistics)+newline);
0041             output_text= strcat(output_text,&quot;BehaveFig=&quot; + num2str(config.BehaveFig)+newline);
0042             output_text= strcat(output_text,&quot;DetrendedEDAFig=&quot; + num2str(config.DetrendedEDAFig)+newline);
0043             output_text= strcat(output_text,&quot;RecurrenceFig=&quot; + num2str(config.RecurrenceFig)+newline);
0044             output_text= strcat(output_text,&quot;QualityFig=&quot; + num2str(config.QualityFig)+newline);
0045             output_text= strcat(output_text,&quot;FrequencyFig=&quot; + num2str(config.FrequencyFig)+newline);
0046             output_text= strcat(output_text,&quot;Statistics=&quot; + num2str(config.Statistics)+newline);
0047             output_text= strcat(output_text,&quot;TopologyPlot=&quot; + num2str(config.topoplot)+newline);
0048             output_text= strcat(output_text,&quot;BrainActivityPlot=&quot; + num2str(config.brainactivity)+newline+newline);
0049             
0050             output_text= strcat(output_text,thinbraid);
0051             output_text= strcat(output_text,&quot;<a href="Data.html" class="code" title="">Data</a> Export Settings&quot;+newline);
0052             output_text= strcat(output_text,thinbraid);
0053             output_text= strcat(output_text,&quot;EEGData=&quot; + num2str(config.EEGData)+newline);
0054             output_text= strcat(output_text,&quot;EDAData=&quot; + num2str(config.EDAData)+newline);
0055             output_text= strcat(output_text,&quot;HRVData=&quot; + num2str(config.HRVData)+newline);
0056             output_text= strcat(output_text,&quot;SignalSpectra=&quot; + num2str(config.signalSpec)+newline+newline);
0057             
0058             output_text= strcat(output_text,thinbraid);
0059             output_text= strcat(output_text,&quot;EEG Quality Settings&quot;+newline);
0060             output_text= strcat(output_text,thinbraid);
0061             output_text= strcat(output_text,&quot;LowerThreshold=&quot; + num2str(config.LowerThreshold)+newline);
0062             output_text= strcat(output_text,&quot;UpperThreshold=&quot; + num2str(config.UpperThreshold)+newline);
0063             output_text= strcat(output_text,&quot;QualityIndex=&quot; + num2str(config.QualityIndex)+newline);
0064             output_text= strcat(output_text,&quot;EEGCutoffValue=&quot; + num2str(config.EEGCutoffValue)+newline+newline);
0065             output_text= strcat(output_text,thinbraid);
0066             
0067             output_text= strcat(output_text,&quot;Resccurence Plot Settings&quot;+newline);
0068             output_text= strcat(output_text,thinbraid);
0069             output_text= strcat(output_text,&quot;RecurrenceTreshold=&quot; + num2str(config.RecurrenceThreshold)+newline+newline);
0070             output_text= strcat(output_text,thinbraid);
0071             
0072             output_text= strcat(output_text,&quot;2D Topology Plot and Brain Activity Plot&quot;+newline);
0073             output_text= strcat(output_text,thinbraid);
0074             output_text= strcat(output_text,&quot;Video Frame Rate[fps]=&quot; + num2str(config.UserFrameRate)+newline);
0075             output_text= strcat(output_text,&quot;2D Topology Intervals[s]=&quot; + num2str(config.UserFrameRate)+newline);
0076             output_text= strcat(output_text,&quot;Brain Acivity Intervals[s]=&quot; + num2str(config.UserFrameRate)+newline+newline);
0077 
0078             output_text= strcat(output_text,fatbraid);
0079             output_text= strcat(output_text,&quot;---&gt; DEVICE SETTINGS&quot;+newline);
0080             output_text= strcat(output_text,fatbraid);
0081             output_text= strcat(output_text,&quot;EEG-DEVICE SETTINGS&quot;+newline);
0082             output_text= strcat(output_text,thinbraid);
0083             output_text= strcat(output_text,&quot;<a href="Device.html" class="code" title="">Device</a> Manufacturer=&quot; + eegDevice.name +newline);
0084             output_text= strcat(output_text,&quot;Sampling Frequency[Hz]=&quot; + num2str(eegDevice.samplingRate)+newline);
0085             output_text= strcat(output_text,&quot;Electrode Positions=&quot; + eegDevice.electrodePositions);
0086             
0087             <span class="keyword">if</span> length(eegDevice.electrodePositions) &gt; 1
0088                 <span class="keyword">for</span> i = 2:length(eegDevice.electrodePositions)
0089                     output_text= strcat(output_text,&quot;, &quot; + eegDevice.electrodePositions(i));
0090                 <span class="keyword">end</span>
0091             <span class="keyword">end</span>
0092             output_text= strcat(output_text,&quot;&quot;+newline);
0093             output_text= strcat(output_text,thinbraid);
0094             output_text= strcat(output_text,&quot;EDA-DEVICE SETTINGS&quot;+newline);
0095             output_text= strcat(output_text,thinbraid);
0096             output_text= strcat(output_text,&quot;<a href="Device.html" class="code" title="">Device</a> Manufacturer=&quot; + edaDevice.name +newline);
0097             output_text= strcat(output_text,&quot;Sampling Frequency[Hz]=&quot; + num2str(edaDevice.samplingRate)+newline);
0098             output_text= strcat(output_text,thinbraid);
0099             output_text= strcat(output_text,&quot;HRV-DEVICE SETTINGS&quot;+newline);
0100             output_text= strcat(output_text,thinbraid);
0101             output_text= strcat(output_text,&quot;<a href="Device.html" class="code" title="">Device</a> Manufacturer=&quot; + hrvDevice.name +newline);
0102             output_text= strcat(output_text,&quot;Sampling Frequency[Hz]=&quot; + num2str(hrvDevice.samplingRate)+newline);
0103             output_text= strcat(output_text,fatbraid);
0104             
0105             fig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0106             axes(<span class="string">'Position'</span>,[0 0.1 1 1],<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0107             <span class="comment">% set it full size for pdf page</span>
0108             set(fig,<span class="string">'Units'</span>,<span class="string">'centimeters'</span>);
0109             fig.Position = [0,0,20.635, 29.35];
0110             descrp = text(0.1,0.9,output_text{1},<span class="string">'FontName'</span>,<span class="string">'FixedWidth'</span>,<span class="string">'FontSize'</span>,8);
0111             descrp.VerticalAlignment = <span class="string">'top'</span>;
0112             print(fName,<span class="string">'-dpdf'</span>,fig,<span class="string">'-r0'</span>);
0113             close(fig);
0114         <span class="keyword">end</span>
0115         
0116         <span class="comment">%% Saves ADIndex settings to fName.pdf</span>
0117         <span class="comment">%   StimuInt: contains settings for all Stimulus Intervals</span>
0118         <span class="comment">%   fName: File name as String</span>
0119         <a name="_sub1" href="#_subfunctions" class="code">function writeAdIndex(self,StimuInt,fName)</a>
0120             fatbraid=&quot;==================================================================================&quot; + newline;
0121             thinbraid=&quot;----------------------------------------------------------------------------------&quot; + newline;
0122             
0123             output_text = strcat(fatbraid,&quot;---&gt; AdIndex SETTINGS&quot;+newline);
0124             output_text= strcat(output_text,fatbraid);
0125             output_text= strcat(output_text,&quot;Stimulus length | Stimulus Type | Stimulus Description |         Stimulus Interval&quot; + newline);
0126             output_text= strcat(output_text,thinbraid);
0127             
0128             <span class="comment">% create textboxes</span>
0129             <span class="keyword">for</span> i = 1:length(StimuInt)
0130                 <span class="comment">% Creates blanks to create a certain structure in the</span>
0131                 <span class="comment">% AdIndex file - see AdIndex.pdf</span>
0132                 
0133                 <span class="comment">% Stimulus length</span>
0134                 CharStimuLength = blanks(15);
0135                 CharStimuLength([9:15]) = <span class="string">'seconds'</span>;
0136                 <span class="comment">% Maintain the length of the stimulus and place it in the</span>
0137                 <span class="comment">% respective place</span>
0138                 <span class="comment">% 1 = 1 digit number, 2 digit number or 3 digit number</span>
0139                 lengthOfStimlus = length(num2str(StimuInt{1, i}.Stimulength));
0140                 <span class="keyword">if</span> lengthOfStimlus == 1 
0141                     CharStimuLength(7) = num2str(StimuInt{1, i}.Stimulength);
0142                 <span class="keyword">elseif</span> lengthOfStimlus == 2
0143                     CharStimuLength(6:7) = num2str(StimuInt{1, i}.Stimulength);
0144                 <span class="keyword">else</span>
0145                     CharStimuLength(5:7) = num2str(StimuInt{1, i}.Stimulength);
0146                 <span class="keyword">end</span>
0147                 
0148                 <span class="comment">% Stimulus type</span>
0149                 <span class="comment">% create blank char array</span>
0150                 <span class="comment">% type allways have to be a one digit number</span>
0151                 CharStimuType = blanks(13);
0152                 CharStimuType([8:11]) = <span class="string">'Type'</span>;
0153                 CharStimuType(13) = num2str(StimuInt{1, i}.stimuIntType);
0154                 
0155                 <span class="comment">% Stimulus Description</span>
0156                 <span class="comment">% the chars have to be place accordingly to their length,</span>
0157                 <span class="comment">% therefor a 20 char vector gets created, substracted the</span>
0158                 <span class="comment">% individual length of the Stimlus Interval and set on the</span>
0159                 <span class="comment">% respective place</span>
0160                 CharStimuDesc = blanks(20);
0161                 CharStartDesc = 20-length(StimuInt{1, i}.stimuIntDescrp)+1;
0162                 CharStimuDesc([CharStartDesc:end]) = StimuInt{1, i}.stimuIntDescrp;
0163                 
0164                 <span class="comment">% Stimulus Intervals</span>
0165                 CharStimuInt = blanks(26);            
0166                 hold = num2str(StimuInt{1, i}.intervals);
0167                 IntChar = <span class="string">''</span>;
0168                 <span class="comment">% loop through all interval chars and seperate them with a</span>
0169                 <span class="comment">% ' '</span>
0170                 <span class="keyword">for</span> i = 1:length(hold)
0171                 IntChar = append(IntChar,hold(i,:));
0172                 IntChar = append(IntChar,<span class="string">' '</span>);
0173                 <span class="keyword">end</span>
0174                 CharStartInt = 26-length(IntChar)+1;
0175                 CharStimuInt([CharStartInt:end]) = IntChar;
0176                 
0177                 <span class="comment">% Save text</span>
0178                 output_text= strcat(output_text,[CharStimuLength <span class="string">' | '</span> CharStimuType <span class="string">' | '</span> CharStimuDesc <span class="string">' | '</span> CharStimuInt]);
0179                 output_text= strcat(output_text,&quot; &quot; + newline);
0180             <span class="keyword">end</span>                
0181             
0182             <span class="comment">%plots data to pdf</span>
0183             fig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0184             axes(<span class="string">'Position'</span>,[0 0.1 1 1],<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0185             <span class="comment">% set it full size for pdf page</span>
0186             set(fig,<span class="string">'Units'</span>,<span class="string">'centimeters'</span>);
0187             fig.Position = [0,0,20.635, 29.35];
0188             descrp = text(0.1,0.9,output_text{1},<span class="string">'FontName'</span>,<span class="string">'FixedWidth'</span>,<span class="string">'FontSize'</span>,8);
0189             descrp.VerticalAlignment = <span class="string">'top'</span>;
0190             print(fName,<span class="string">'-dpdf'</span>,fig,<span class="string">'-r0'</span>);
0191             close(fig);
0192         <span class="keyword">end</span>
0193         
0194         <span class="comment">%% Saves statistics as PDF</span>
0195         <span class="comment">%   stats: statistics as String</span>
0196         <span class="comment">%   fName: File name as String</span>
0197         <a name="_sub2" href="#_subfunctions" class="code">function writeStatistics(self,stats,fName)</a>
0198             fig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0199             axes(<span class="string">'Position'</span>,[0.0 0.0 1 1],<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0200             fig.PaperPositionMode=<span class="string">'auto'</span>;
0201             stats = text(0.0,0.75,stats,<span class="string">'FontName'</span>,<span class="string">'FixedWidth'</span>,<span class="string">'FontSize'</span>,6); <span class="comment">% Changed font size to 6 (from 8) for displaying the whole text</span>
0202             print(fName,<span class="string">'-dpdf'</span>,fig,<span class="string">'-r0'</span>);
0203             close(fig);
0204         <span class="keyword">end</span>
0205         
0206         <span class="comment">%% Saves in/valid Subjects and status</span>
0207         <span class="comment">%   index: index as String</span>
0208         <span class="comment">%   fName: File name as String</span>
0209         <a name="_sub3" href="#_subfunctions" class="code">function writeValid(self,index, fName)</a>
0210             header = index(1:3);
0211             index = index(4:end);
0212             numberOfPages = ceil(length(index)/50);
0213             
0214 <span class="comment">%             % for loop to create different pages if more than 50 subjects</span>
0215 <span class="comment">%             if numberOfPages == 1</span>
0216 <span class="comment">%</span>
0217 <span class="comment">%                 % setup fig</span>
0218 <span class="comment">%                 fig = figure('Visible','off');</span>
0219 <span class="comment">%                 axes('Position',[0.1 0.1 1 1],'Visible','off');</span>
0220 <span class="comment">%                 fig.PaperPositionMode='auto';</span>
0221 <span class="comment">%                 % set it full size for pdf page</span>
0222 <span class="comment">%                 set(fig,'Units','centimeters');</span>
0223 <span class="comment">%                 fig.Position = [0,0,20.635, 29.35];</span>
0224 <span class="comment">%</span>
0225 <span class="comment">%                 % print fig and save as pdf</span>
0226 <span class="comment">%                 descrp = text(0.1,0.9,index,'FontName','FixedWidth','FontSize',8);</span>
0227 <span class="comment">%                 descrp.VerticalAlignment = 'top';</span>
0228 <span class="comment">%                 print(fName,'-dpdf',fig,'-r0','-fillpage');</span>
0229                 
0230             <span class="keyword">for</span> i = 1:numberOfPages
0231                 <span class="comment">% setup fig</span>
0232                 fig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0233                 axes(<span class="string">'Position'</span>,[0.1 0.1 1 1],<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0234                 fig.PaperPositionMode=<span class="string">'auto'</span>;
0235                 <span class="comment">% set it full size for pdf page</span>
0236                 set(fig,<span class="string">'Units'</span>,<span class="string">'centimeters'</span>);
0237                 fig.Position = [0,0,20.635, 29.35];
0238                 
0239                 <span class="comment">% get index for subject &lt; 50</span>
0240                 <span class="keyword">if</span> numberOfPages == 1
0241                     indexPage = index(1:end);
0242                 
0243                 <span class="comment">% subject &gt; 50</span>
0244                 <span class="comment">% get first 50 subjects</span>
0245                 <span class="keyword">elseif</span> i == 1
0246                     indexPage = index(1:50);
0247                     
0248                 <span class="comment">% subjects for the last page</span>
0249                 <span class="keyword">elseif</span> i == numberOfPages
0250                     indexPage = index(50*(i-1):end);
0251                     
0252                 <span class="comment">% get all subjects in the middel</span>
0253                 <span class="keyword">else</span>
0254                     indexPage = index(50*i-1:50*i);
0255                     
0256                 <span class="keyword">end</span>
0257 
0258                 <span class="comment">% print fig and save as pdf</span>
0259                 indexPage = cat(1,header,indexPage);
0260                 descrp = text(0.1,0.9,indexPage,<span class="string">'FontName'</span>,<span class="string">'FixedWidth'</span>,<span class="string">'FontSize'</span>,8);
0261                 descrp.VerticalAlignment = <span class="string">'top'</span>;
0262                 fNamePage = [fName(1:length(fName)-4) <span class="string">'_'</span> num2str(i) <span class="string">'.pdf'</span>];
0263                 print(fNamePage,<span class="string">'-dpdf'</span>,fig,<span class="string">'-r0'</span>,<span class="string">'-fillpage'</span>);
0264             <span class="keyword">end</span>
0265             close(fig);
0266         <span class="keyword">end</span>
0267         
0268         <span class="comment">%% Writes array or cell array to csv file with given format and file name</span>
0269         <span class="comment">%  fName: Name of the File to write as String</span>
0270         <span class="comment">%  format: Format String</span>
0271         <span class="comment">%  data: CellArray or Array</span>
0272         <a name="_sub4" href="#_subfunctions" class="code">function writeCSV(self,fName,format,data)</a>
0273             fid = fopen(fName,<span class="string">'w'</span>);
0274             <span class="keyword">if</span> iscell(data)
0275                 fprintf(fid,format,data{:});
0276             <span class="keyword">else</span>
0277                 fprintf(fid,format,data);
0278             <span class="keyword">end</span>
0279             fclose(fid);
0280         <span class="keyword">end</span>
0281 
0282         <span class="comment">%% Print 2D Topo of EEG Data</span>
0283         <span class="comment">%  Print of 2D Topology map over a certain timeframe</span>
0284         <span class="comment">%  config: contains all configs as String</span>
0285         <span class="comment">%  EEG: contains EEG Structur for topoplot function</span>
0286         <span class="comment">%  subject: contains all Subjects</span>
0287         <span class="comment">%  StimuDef: Simulus Class, with length, type, definition</span>
0288         <span class="comment">%  electrodes: contains all used electrodes as String</span>
0289         <span class="comment">%  vidFrameReSize: Contains struct with each video frame</span>
0290         <a name="_sub5" href="#_subfunctions" class="code">function printTopo(self,config,subject,EEG,StimuDef,electrodes)            </a>
0291             <span class="comment">% Variables needed for loop</span>
0292             numStimuInts = length(StimuDef);
0293             interval = config.TopoRange;
0294             subjectName = subject.name;
0295             TopoStart = 0;
0296             timestamps = [];
0297             
0298             <span class="comment">% loop for each Stimulus Interval</span>
0299             <span class="keyword">for</span> i = 1:numStimuInts
0300                 StimuInt = StimuDef{i};
0301                 
0302                 <span class="comment">%create subfolder</span>
0303                 subfolder_name = <span class="string">'2D_TopologyMap'</span>;
0304                 
0305                 <span class="keyword">if</span> ~exist([subject.OutputDirectory <span class="string">'\'</span> subfolder_name], <span class="string">'dir'</span>)
0306                 parentfolder = subject.OutputDirectory;
0307                 mkdir(fullfile(parentfolder, subfolder_name));
0308                 <span class="keyword">end</span>
0309                 
0310                 <span class="comment">% video obj</span>
0311                 vName = [subject.OutputDirectory <span class="string">'\'</span> subfolder_name <span class="string">'/'</span> subjectName <span class="string">'_'</span> StimuInt.stimuIntDescrp <span class="string">'_2D Topo_Video.mp4'</span>];
0312                 vidObj = VideoWriter(vName);
0313                 vidObj.Quality = 100;       
0314                 vidObj.FrameRate = config.UserFrameRate; <span class="comment">% get framerate from video</span>
0315                 
0316                 <span class="comment">% prepare print range</span>
0317                 TopoEnd = StimuInt.Stimulength *1000 + TopoStart; <span class="comment">%1000 - Tim</span>
0318                 range = TopoStart:interval:TopoEnd; <span class="comment">% devided by 1000 to convert ms into s</span>
0319                 range = double(range);
0320                 TopoStart = TopoEnd; <span class="comment">% defined for the next loop</span>
0321                 
0322                 <span class="comment">% only print Type &gt; 4 = Video/Images/Audio Stimulus</span>
0323                 <span class="keyword">if</span> StimuInt.stimuIntType &gt;= 4
0324                     
0325                     <span class="comment">% prepare video for print</span>
0326                     fileDirectory = [config.videoString <span class="string">'\'</span> StimuInt.stimuIntDescrp <span class="string">'.mp4'</span>]; <span class="comment">% get directory</span>
0327                     <span class="comment">%fileDirectory = regexprep(fileDirectory, ' ', '_');</span>
0328                     vid = VideoReader(fileDirectory); <span class="comment">% import video</span>
0329                     numOfFrames = round(vid.FrameRate*vid.Duration); <span class="comment">% calculate number of frames</span>
0330                     vidFrame = read(vid,[1 numOfFrames]);
0331                     <span class="comment">% resize video according to UserFrameRate</span>
0332                     vidFrameReSize = vidFrame(:,:,:,round(1:vid.FrameRate/config.UserFrameRate:end));
0333                     
0334                     <span class="comment">% prepare data for print</span>
0335                     SIGTMP = reshape(EEG.data, EEG.nbchan, EEG.pnts, EEG.trials);
0336                     pos = round((range/1000-EEG.xmin)/(EEG.xmax-EEG.xmin) * (EEG.pnts-1))+1; <span class="comment">% Gernot / Tim -&gt; 1000 abändern, auf mögliche 364 - Testen</span>
0337                         <span class="keyword">if</span> pos(end) == EEG.pnts+1
0338                             pos(end) = pos(end)-1; <span class="comment">% Cut 1 so index of pnts and pos is ==</span>
0339                         <span class="keyword">end</span>
0340                     nanpos = find(isnan(pos));
0341                     pos(nanpos) = 1;
0342                     
0343                     <span class="comment">% create variable for .csv export with all timestamps</span>
0344                     timestamps = cat(1,timestamps,range(1:end-1)'/1000);
0345                     
0346                     <span class="comment">% prepare task variable</span>
0347                     numPos = length(pos)-1;
0348                     numValues = subject.eegValuesForElectrodes; 
0349                     numElec = length(numValues);
0350                     task = zeros(numElec,numPos);
0351 
0352                     <span class="comment">% get TEI</span>
0353                     <span class="keyword">for</span> m = 1:numPos
0354                         <span class="keyword">for</span> j = 1:numElec
0355                         <span class="comment">% eegfiltfft is a eeglab function for (high|low|band) -</span>
0356                         <span class="comment">% pass filter data using inverse fft - for more</span>
0357                         <span class="comment">% information please look at eegfiltfft.m</span>
0358                         
0359                         <span class="comment">% Theta(5-7 Hz)</span>
0360                         theta(j) = mean(sqrt((eegfiltfft(SIGTMP(j,pos(m):pos(m+1),:),EEG.srate,5,7)).^2)); <span class="comment">%Warum wird Theta 0 bei Werten &gt; 1000ms?</span>
0361                         <span class="comment">% Alpha(8-13 Hz)</span>
0362                         alpha(j) = mean(sqrt((eegfiltfft(SIGTMP(j,pos(m):pos(m+1),:),EEG.srate,8,13)).^2));
0363                         <span class="comment">% Beta1(14-24 Hz)</span>
0364                         beta1(j) = mean(sqrt((eegfiltfft(SIGTMP(j,pos(m):pos(m+1),:),EEG.srate,14,24)).^2));
0365                         <span class="comment">% Beta2(25-40 Hz)</span>
0366                         beta2(j) = mean(sqrt((eegfiltfft(SIGTMP(j,pos(m):pos(m+1),:),EEG.srate,25,40)).^2));
0367                         <span class="comment">% TEI Index</span>
0368                             <span class="keyword">if</span> alpha(j) &gt; 0 &amp;&amp; theta(j) &gt; 0 <span class="comment">% Theta = 0 bei 900ms, geht in else - else war falsch programmiert</span>
0369                             task(j,m) = beta1(j)/(alpha(j)+theta(j));
0370                             <span class="keyword">else</span>
0371                             task(j,m) = 0; <span class="comment">% zeros(1,length(range)-1); alter Befehl, welcher für die erzeugung von einem ganzen Vector gedacht war</span>
0372                             <span class="keyword">end</span>
0373                         <span class="keyword">end</span>
0374                         <span class="comment">% get all signalSpec Data</span>
0375                         Signals = [theta; alpha; beta1;beta2;task(:,m)']';
0376                         subject.signalSpec = cat(1,subject.signalSpec,Signals);
0377                     <span class="keyword">end</span>
0378                     
0379                     
0380                     
0381                     <span class="comment">% loop preperation</span>
0382                     numofprint = length(range)-1;
0383                     <span class="keyword">if</span> config.videoOutput == 1
0384                         open(vidObj);
0385                     <span class="keyword">end</span>
0386                     
0387                     <span class="keyword">for</span> k = 1:numofprint
0388                         <span class="comment">% print preparation</span>
0389                         mainfig = figure(<span class="string">'Visible'</span>,<span class="string">'on'</span>);
0390                         set(mainfig,<span class="string">'PaperUnits'</span>,<span class="string">'inches'</span>,<span class="string">'PaperPosition'</span>,[0 0 12 7.5])
0391                         hold on
0392 
0393                         <span class="comment">% Print of 2D Topo</span>
0394                         subplot(2,2,3);
0395                         <span class="comment">% double () in case we want to add a multiplier</span>
0396                         title({[<span class="string">'AVG TEI between '</span> num2str((range(k)-range(1))) <span class="string">'-'</span> num2str((range(k+1)-range(1))) <span class="string">'ms'</span>];<span class="keyword">...</span>
0397                                [<span class="string">'in test range from '</span> num2str((range(k))) <span class="string">'-'</span> num2str((range(k+1))) <span class="string">'ms'</span>               ]});
0398                         <span class="comment">% topoplot is a function of the eeglab libary</span>
0399                         topoplot(task(:,k),EEG.chanlocs,<span class="string">'electrodes'</span>,<span class="string">'ptslabels'</span>);
0400                         cb = colorbar;
0401                         cb.Limits = [0,1];
0402 
0403                         <span class="comment">% print of histogram</span>
0404                         barsimg = self.plotElectrodeBars(electrodes,pos(k),pos(k+1),SIGTMP,EEG.srate);    
0405                         barschart = subplot(2,2,4);
0406                         barschart.Position = barschart.Position + [-0.075 -0.075 0.15 0.15];
0407                         imshow(barsimg);
0408 
0409                         <span class="comment">% Subplot title</span>
0410                         sgtitle([StimuInt.stimuIntDescrp <span class="string">' for subject '</span> subject.name]);
0411                         
0412                         <span class="comment">% print out first frame</span>
0413                         videochart = subplot(2,2,[1 2]);
0414                         imshow(vidFrameReSize(:,:,:,(vidObj.FrameRate*k)));
0415                         fName = [subject.OutputDirectory <span class="string">'\'</span> subfolder_name <span class="string">'/'</span> subjectName <span class="string">'_'</span> StimuInt.stimuIntDescrp <span class="string">'_'</span> num2str((range(k+1))) <span class="string">'ms_2D Topo.png'</span>];
0416                         print(fName,<span class="string">'-dpng'</span>,<span class="string">'-r300'</span>,mainfig);
0417                         
0418                         <span class="keyword">if</span> config.videoOutput == 1
0419                             <span class="comment">% set render to opengl</span>
0420                             set(mainfig,<span class="string">'units'</span>,<span class="string">'pixels'</span>,<span class="string">'position'</span>,[0 0 640 480]) 
0421                             set(gcf,<span class="string">'renderer'</span>,<span class="string">'opengl'</span>) 
0422                             drawnow nocallbacks
0423                             
0424                             <span class="comment">% add to test VM - delete comment</span>
0425                             <span class="comment">% set(videoObj, 'LoggingMode', 'memory');</span>
0426                             
0427                             <span class="comment">%create video in plot</span>
0428                             <span class="keyword">for</span> t = 1:vidObj.FrameRate
0429                                 <span class="comment">% insert video frames</span>
0430                                 videochart = subplot(2,2,[1 2]);
0431                                 imshow(vidFrameReSize(:,:,:,t+(vidObj.FrameRate*k)));
0432                                 
0433                                 <span class="comment">% get frame from figure</span>
0434                                 currentFrame = getframe(mainfig);
0435                                 
0436                                 <span class="comment">% create video</span>
0437                                 writeVideo(vidObj, currentFrame);
0438                             <span class="keyword">end</span>
0439                         <span class="keyword">end</span>
0440                         <span class="comment">% close figure</span>
0441                         close
0442                     <span class="keyword">end</span>     
0443                 <span class="keyword">end</span>
0444             <span class="keyword">end</span>
0445             <span class="keyword">if</span> config.signalSpec == 1
0446                 allElectrodes = [];
0447                 <span class="keyword">for</span> i = 1:numElec               
0448                     header = [subject.Electrodes{i} + &quot;_Theta_5-7Hz&quot;,subject.Electrodes{i} + &quot;_Alpha_8-13Hz&quot;,<span class="keyword">...</span>
0449                               subject.Electrodes{i} + &quot;_Beta1_14-24Hz&quot;,subject.Electrodes{i} + &quot;_Beta2_25-45Hz&quot;,<span class="keyword">...</span>
0450                               subject.Electrodes{i} + &quot;_TEI_Index&quot;];
0451                     
0452                     signalsPerElectrode = subject.signalSpec(i:numElec:<span class="keyword">end</span>,:);
0453                     signalsPerElectrode = cat(1,header,signalsPerElectrode);            
0454                     allElectrodes = cat(2,allElectrodes,signalsPerElectrode); 
0455                 <span class="keyword">end</span>    
0456                 <span class="comment">% calculate AVG.</span>
0457                 avgTheta = mean(str2double(allElectrodes(2:<span class="keyword">end</span>,1:5:end)),2);
0458                 avgAlpha = mean(str2double(allElectrodes(2:<span class="keyword">end</span>,2:5:end)),2);
0459                 avgBeta1 = mean(str2double(allElectrodes(2:<span class="keyword">end</span>,3:5:end)),2);
0460                 avgBeta2 = mean(str2double(allElectrodes(2:<span class="keyword">end</span>,4:5:end)),2);
0461                 avgTEI = mean(str2double(allElectrodes(2:<span class="keyword">end</span>,5:5:end)),2);
0462                 
0463                 avgTheta = cat(1,&quot;AVG_Theta_5-7Hz&quot;,avgTheta);
0464                 avgAlpha  = cat(1,&quot;AVG__Alpha_8-13Hz&quot;,avgAlpha);
0465                 avgBeta1  = cat(1,&quot;AVG_Beta1_14-24Hz&quot;,avgBeta1);
0466                 avgBeta2  = cat(1,&quot;AVG_Beta2_25-45Hz&quot;,avgBeta2);
0467                 avgTEI = cat(1,&quot;AVG_TEI_Index&quot;,avgTEI);
0468                 
0469                 allElectrodes = cat(2,avgTEI,allElectrodes);
0470                 allElectrodes = cat(2,avgBeta2,allElectrodes);
0471                 allElectrodes = cat(2,avgBeta1,allElectrodes);
0472                 allElectrodes = cat(2,avgAlpha,allElectrodes);
0473                 allElectrodes = cat(2,avgTheta,allElectrodes);
0474                 
0475                 <span class="comment">% add time</span>
0476                 timestamps = [&quot;Time[s]&quot;;timestamps];
0477                 allElectrodes = cat(2,timestamps,allElectrodes);
0478                 
0479                 fname = [subject.OutputDirectory <span class="string">'/'</span> subject.name <span class="string">'_PowerSignalSpectra_Values.csv'</span>];
0480                 writematrix(allElectrodes,fname,<span class="string">'Delimiter'</span>,<span class="string">'semi'</span>);
0481             <span class="keyword">end</span>
0482         <span class="keyword">end</span>
0483         
0484         <span class="comment">%% Overview of all Simulus in one chart</span>
0485         <span class="comment">%  Print of 2D Topology map over a certain timeframe</span>
0486         <span class="comment">%  The plots are strung together over the entire time frame of the</span>
0487         <span class="comment">%  experiment and divided into their stimlus intervals</span>
0488         
0489         <span class="comment">%  config: contains all configs as String</span>
0490         <span class="comment">%  subject: contains all Subjects</span>
0491         <span class="comment">%  EEG: contains EEG Structur for topoplot function</span>
0492         <span class="comment">%  StimuDef: Simulus Class, with length, type, definition</span>
0493         <a name="_sub6" href="#_subfunctions" class="code">function stimulusOverviewChart(self,config,subject,EEG,StimuDef)</a>
0494             
0495             <span class="comment">% Variables needed for loop</span>
0496             numStimuInts = length(StimuDef);
0497             interval = config.BrainRange;
0498             TopoStart = 0;
0499             rangeAll = 0;
0500             StimulusIntervals = 0;
0501             StimuIntDefinitions = [];
0502             
0503             <span class="comment">% main figure</span>
0504             mainfig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0505             set(mainfig,<span class="string">'Units'</span>,<span class="string">'pixels'</span>);
0506             
0507             <span class="comment">% prepare vector to draw lines</span>
0508             <span class="keyword">for</span> i = 1:numStimuInts
0509                 StimuInt = StimuDef{i};   
0510                 <span class="keyword">if</span> StimuInt.stimuIntType &gt; 2
0511                     <span class="comment">% Initialisation for first loop</span>
0512                     <span class="keyword">if</span> TopoStart == 0
0513                         rangeAll = double(StimuInt.Stimulength*1000);
0514                         TopoStart = double(StimuInt.Stimulength*1000);
0515                     <span class="keyword">end</span>
0516                     <span class="comment">% prepare print range</span>
0517                     <span class="comment">% creates vector range from start to end in a certain</span>
0518                     <span class="comment">% interval</span>
0519                     TopoEnd = StimuInt.Stimulength*1000 + TopoStart;
0520                     range = TopoStart:interval:TopoEnd;
0521                     range = double(range);
0522                     <span class="keyword">if</span> range(end) ~= TopoEnd
0523                         range(end+1) = TopoEnd;
0524                     <span class="keyword">end</span>
0525                     TopoStart = TopoEnd; <span class="comment">% defined for the next loop</span>
0526                     
0527                     <span class="comment">% save the ranges between each head for all stimlus</span>
0528                     <span class="comment">% intervals</span>
0529                     rangeAll = [rangeAll range(1,2:end)];
0530                     <span class="keyword">if</span> StimulusIntervals == 0
0531                         StimulusIntervals = size(rangeAll);
0532                         StimulusIntervals(2) = StimulusIntervals(2)-1;
0533                     <span class="keyword">else</span>
0534                         StimulusIntervals = [StimulusIntervals, StimulusIntervals(end)+1,length(rangeAll)-1];
0535                     <span class="keyword">end</span>
0536                     
0537                     StimuIntDefinitions = [StimuIntDefinitions, convertCharsToStrings(StimuInt.stimuIntDescrp)];
0538                 <span class="keyword">end</span>
0539             <span class="keyword">end</span>
0540 
0541             <span class="comment">% prepare data for print</span>
0542             SIGTMP = reshape(EEG.data, EEG.nbchan, EEG.pnts, EEG.trials);
0543             pos = round((rangeAll/1000-EEG.xmin)/(EEG.xmax-EEG.xmin) * (EEG.pnts-1))+1;
0544             <span class="keyword">if</span> pos(end) == EEG.pnts+1
0545                 pos(end) = pos(end)-1; <span class="comment">% Cut 1 so index of pnts and pos is ==</span>
0546             <span class="keyword">end</span>
0547             nanpos = find(isnan(pos));
0548             pos(nanpos) = 1;
0549 
0550             <span class="comment">% prepare task variable</span>
0551             numPrints = length(pos)-1;
0552             numValues = subject.eegValuesForElectrodes; 
0553             numElec = length(numValues);
0554             task = zeros(numElec,numPrints);
0555 
0556             <span class="comment">% get TEI</span>
0557             <span class="keyword">for</span> m = 1:numPrints
0558                 <span class="keyword">for</span> j = 1:numElec
0559                     <span class="comment">% Theta(5-7 Hz)</span>
0560                     theta(j) = mean(sqrt((eegfiltfft(SIGTMP(j,pos(m):pos(m+1),:),EEG.srate,5,7)).^2));
0561                     <span class="comment">% Alpha(8-13 Hz)</span>
0562                     alpha(j) = mean(sqrt((eegfiltfft(SIGTMP(j,pos(m):pos(m+1),:),EEG.srate,8,13)).^2));
0563                     <span class="comment">% Beta1(14-24 Hz)</span>
0564                     beta1(j) = mean(sqrt((eegfiltfft(SIGTMP(j,pos(m):pos(m+1),:),EEG.srate,14,24)).^2));
0565                     <span class="comment">% Task-Engagement</span>
0566                     <span class="keyword">if</span> alpha(j) &gt; 0 &amp;&amp; theta(j) &gt; 0
0567                         task(j,m) = beta1(j)/(alpha(j)+theta(j));
0568                     <span class="keyword">else</span>
0569                         task(j,m) = 0;
0570                     <span class="keyword">end</span>
0571                 <span class="keyword">end</span>
0572             <span class="keyword">end</span>
0573 
0574             
0575             <span class="comment">% print preparation</span>
0576             sizey = 300; <span class="comment">% height of image</span>
0577             Pos = cell(1,numPrints); <span class="comment">% vector for position</span>
0578             topoX = 100; <span class="comment">% X position of first head in print</span>
0579             mainfig.Position = [mainfig.Position(1), mainfig.Position(2), numPrints*150 , sizey]; 
0580             
0581             <span class="keyword">for</span> j = 1:numPrints
0582                 <span class="comment">% Print of 2D Topo</span>
0583                 topo = subplot(1,numPrints,j);
0584                 topo.Units = <span class="string">'pixels'</span>;
0585                 topo.Position = [topoX, 40, 90, 90]; <span class="comment">% set position</span>
0586                 <span class="comment">% topoplot is a function of the eeglab libary</span>
0587                 topoplot(task(:,j),EEG.chanlocs,<span class="string">'electrodes'</span>,<span class="string">'on'</span>);
0588                 topoX = topoX + 110; <span class="comment">% move X position for next head</span>
0589 
0590                 <span class="comment">% get Positions of topo plots</span>
0591                 Pos{j} = topo.Position;
0592             <span class="keyword">end</span>
0593             
0594             <span class="comment">% set sizeX to mainfig position length</span>
0595             <span class="comment">% will be needed to position the topoplots accordingly</span>
0596             sizex = mainfig.Position(3);
0597             
0598             <span class="comment">% loop for legend in topoplot</span>
0599             counter = 1;
0600             <span class="keyword">for</span> m = 1:(length(StimulusIntervals)/2)
0601                 <span class="comment">% get index for Postions vector</span>
0602                 lowindex = StimulusIntervals(counter); <span class="comment">% last topoplot</span>
0603                 counter = counter + 1;
0604                 index = StimulusIntervals(counter); <span class="comment">% latest topoplot</span>
0605                 counter = counter + 1;
0606                 <span class="keyword">if</span> length(Pos) &gt; index
0607                     <span class="comment">% get position of figures left/right</span>
0608                     SubplotLeft = Pos{index};
0609                     SubplotRight = Pos{index+1};
0610                     <span class="comment">% get X coordinate between both heads</span>
0611                     x = ((SubplotLeft(1)+ SubplotLeft(3) + SubplotRight(1))/2)/sizex;<span class="comment">% convert from pixels to normazied unit</span>
0612                 <span class="keyword">else</span>
0613                     SubplotLeft = Pos{index};
0614                     x = (SubplotLeft(1) + SubplotLeft(3))/sizex;
0615                 <span class="keyword">end</span>
0616                 y = SubplotLeft(2)/sizey; <span class="comment">% convert from pixels to normazied unit</span>
0617                 <span class="comment">% timestamp line for each interval</span>
0618                 timeLine = annotation(<span class="string">'line'</span>,[x,x],[0.6,y]);
0619                 pause(0.5) <span class="comment">% force figure update</span>
0620                 timeLine.LineWidth = 1;
0621                 <span class="comment">% timestamp text</span>
0622                 str = strcat(num2str(rangeAll(index+1)-rangeAll(1)),<span class="string">' ms'</span>);
0623                 timestamp = annotation(<span class="string">'textbox'</span>,[x,0.035,0.1,0.1],<span class="string">'String'</span>,str,<span class="string">'EdgeColor'</span>,<span class="string">'none'</span>,<span class="string">'FitBoxToText'</span>,<span class="string">'on'</span>);
0624                 pause(0.5) <span class="comment">% force figure update</span>
0625                 <span class="comment">% move text for half its size, because start getting printed on X position</span>
0626                 timestamp.Position = timestamp.Position - [(timestamp.Position(3)/2),0,0,0];
0627                 
0628                 <span class="comment">% dotted lines for clarity between each head of the same</span>
0629                 <span class="comment">% interval</span>
0630                 numOfLines = (index - lowindex);
0631                 linesPos = lowindex;
0632                 <span class="keyword">for</span> k = 1:numOfLines
0633                     <span class="keyword">if</span> length(Pos) &gt; linesPos
0634                         SubplotLeft = Pos{linesPos};
0635                         SubplotRight = Pos{linesPos+1};
0636                         x = ((SubplotLeft(1)+ SubplotLeft(3) + SubplotRight(1))/2)/sizex;<span class="comment">% convert to normazied unit</span>
0637                     <span class="keyword">else</span>
0638                         SubplotLeft = Pos{linesPos};
0639                         x = (SubplotLeft(1) + SubplotLeft(3))/sizex;
0640                     <span class="keyword">end</span>
0641                     y = SubplotLeft(2)/sizey; <span class="comment">% convert to normazied unit</span>
0642                     <span class="comment">% line</span>
0643                     tickLines = annotation(<span class="string">'line'</span>,[x,x],[0.6,y]);
0644                     pause(0.5) <span class="comment">% force figure update</span>
0645                     tickLines.Color = <span class="string">'b'</span>; <span class="comment">% blue</span>
0646                     tickLines.LineStyle = <span class="string">'--'</span>; <span class="comment">% dotted</span>
0647                     tickLines.LineWidth = 0.25; 
0648                     linesPos = linesPos + 1;
0649                     
0650                     <span class="comment">% timestamp text</span>
0651                     <span class="keyword">if</span> length(rangeAll) &gt; linesPos
0652                     str = strcat(num2str(rangeAll(linesPos)-rangeAll(1)),<span class="string">' ms'</span>);
0653                     addLines = annotation(<span class="string">'textbox'</span>,[x,0.035,0.1,0.1],<span class="string">'String'</span>,str,<span class="string">'EdgeColor'</span>,<span class="string">'none'</span>,<span class="string">'FitBoxToText'</span>,<span class="string">'on'</span>,<span class="string">'FontSize'</span>, 8);
0654                     pause(0.5) <span class="comment">% force figure update</span>
0655                     addLines.Position = addLines.Position - [(addLines.Position(3)/2),0,0,0];
0656                     <span class="keyword">end</span>
0657                 <span class="keyword">end</span>
0658                 
0659                 <span class="comment">% Stimulus definiton text</span>
0660                 <span class="comment">% get Stimulus</span>
0661                 str = StimuIntDefinitions(m);
0662                 <span class="comment">% get position of first and last head of Interval</span>
0663                 <span class="keyword">if</span> length(Pos) &gt; index
0664                     SubplotLeft = Pos{lowindex};
0665                     SubplotRight = Pos{index};
0666                 <span class="keyword">else</span>
0667                     SubplotLeft = Pos{lowindex};
0668                     SubplotRight = Pos{index-1};
0669                 <span class="keyword">end</span>
0670                 <span class="comment">% get x for middle of this interval</span>
0671                 x = ((SubplotLeft(1) + SubplotRight(1) + SubplotRight(3))/2)/sizex;
0672                 StimulusDefinition = annotation(<span class="string">'textbox'</span>,[x,0.575,0.1,0.1],<span class="string">'String'</span>,str,<span class="string">'EdgeColor'</span>,<span class="string">'none'</span>,<span class="string">'FitBoxToText'</span>,<span class="string">'on'</span>);
0673                 pause(0.5)
0674                 <span class="comment">% move text for half its size</span>
0675                 StimulusDefinition.Position = StimulusDefinition.Position - [(StimulusDefinition.Position(3)/2),0,0,0];
0676             <span class="keyword">end</span>
0677             
0678             <span class="comment">% upper horizontal timeline</span>
0679             SubplotLeft = Pos{1};
0680             SubplotRight = Pos{end};
0681             x1 = SubplotLeft(1)/sizex;
0682             x2 = (SubplotRight(1)+SubplotRight(3))/sizex;
0683             timeLine = annotation(<span class="string">'line'</span>,[x1,x2],[0.6,0.6]);
0684             pause(0.5) <span class="comment">% force figure update</span>
0685             timeLine.LineWidth = 1;
0686             
0687             <span class="comment">% first timestamp line</span>
0688             SubplotTopo = Pos{1};
0689             x = SubplotTopo(1)/sizex;
0690             y = SubplotTopo(2)/sizey;
0691             timeLine = annotation(<span class="string">'line'</span>,[x,x],[0.6,y]);
0692             pause(0.5) <span class="comment">% force figure update</span>
0693             timeLine.LineWidth = 1;
0694             <span class="comment">% first timestamp text</span>
0695             timestamp = annotation(<span class="string">'textbox'</span>,[x,0.035,0.1,0.1],<span class="string">'String'</span>,<span class="string">'0 ms'</span>,<span class="string">'EdgeColor'</span>,<span class="string">'none'</span>);
0696             pause(0.5)
0697             timestamp.Position = timestamp.Position - [(timestamp.Position(3)/2),0,0,0];
0698             
0699             <span class="comment">% Subplot title</span>
0700             str = <span class="string">'Per Electrode Brain Activity over all Stimulus Intervals'</span>;
0701             x = (SubplotRight(1)+SubplotRight(3)-SubplotLeft(1))/2/sizex;
0702             annotation(<span class="string">'textbox'</span>,[x,0.8,0.1,0.1],<span class="string">'String'</span>,str,<span class="string">'EdgeColor'</span>,<span class="string">'none'</span>,<span class="string">'FitBoxToText'</span>,<span class="string">'on'</span>);
0703             pause(0.5) <span class="comment">% force figure update</span>
0704    
0705             <span class="comment">% save as pdf</span>
0706             newWidth = SubplotRight(1)+ SubplotRight(3) + 100; <span class="comment">% get right width of image</span>
0707             fName = [subject.OutputDirectory <span class="string">'\'</span> subject.name <span class="string">'_Brain activity over entire stimulus period.png'</span>];
0708             set(gcf,<span class="string">'color'</span>,<span class="string">'w'</span>);
0709             F = getframe(mainfig); <span class="comment">% get frame of figure</span>
0710             ImageSize = size(F.cdata); <span class="comment">% get length of figure</span>
0711             F.cdata(:,newWidth:ImageSize(2),:) = []; <span class="comment">% delete empty pixel</span>
0712             imwrite(F.cdata, fName, <span class="string">'png'</span>);
0713             
0714             <span class="comment">% close figure</span>
0715             close
0716         <span class="keyword">end</span>
0717         
0718         <span class="comment">%% Prints of electrode frequency</span>
0719         <span class="comment">% electrodes: List of used electrodes</span>
0720         <span class="comment">% startpos/endpos: Range of the printed data</span>
0721         <span class="comment">% data: data</span>
0722         <span class="comment">% srate: Frequency of the device used</span>
0723         <a name="_sub7" href="#_subfunctions" class="code">function barsimg = plotElectrodeBars(self,electrodes,startpos,endpos,data,srate)</a>
0724             
0725             <span class="comment">% prepare plot</span>
0726             numelec = length(electrodes);
0727             barsfig = figure(<span class="string">'visible'</span>,<span class="string">'off'</span>,<span class="string">'DefaultAxesFontSize'</span>,12);
0728             set(barsfig,<span class="string">'color'</span>,<span class="string">'w'</span>);
0729             set(barsfig,<span class="string">'Position'</span>, [1, 1, 1200, 1200]);
0730             data = data(:,startpos:endpos);
0731             
0732             <span class="comment">% get frequency bands</span>
0733             <span class="keyword">for</span> i = 1:numelec
0734                 <span class="comment">% Delta (1-4 Hz)</span>
0735                 delta(i) = mean(sqrt((eegfiltfft(data(i,:),srate,1,4)).^2));
0736                 <span class="comment">% Theta(5-7 Hz)</span>
0737                 theta(i) = mean(sqrt((eegfiltfft(data(i,:),srate,5,7)).^2));
0738                 <span class="comment">% Alpha(8-13 Hz)</span>
0739                 alpha(i) = mean(sqrt((eegfiltfft(data(i,:),srate,8,13)).^2));
0740                 <span class="comment">% Beta1(14-24 Hz)</span>
0741                 beta1(i) = mean(sqrt((eegfiltfft(data(i,:),srate,14,24)).^2));
0742                 <span class="comment">% Beta2(25-40 Hz)</span>
0743                 beta2(i) = mean(sqrt((eegfiltfft(data(i,:),srate,25,40)).^2));
0744             <span class="keyword">end</span>
0745             allfreq = [delta theta alpha beta1 beta2];
0746             ymax = max(max(allfreq)); <span class="comment">% y max for graph</span>
0747             
0748             <span class="comment">% Print</span>
0749             <span class="keyword">for</span> i = 1:numelec
0750                 hold on
0751                 <span class="comment">% create subplot for each electrode</span>
0752                 subplot(3,3,i);
0753                 names = categorical({<span class="string">'delta'</span>,<span class="string">'theta'</span>,<span class="string">'alpha'</span>,<span class="string">'beta1'</span>,<span class="string">'beta2'</span>});
0754                 names = reordercats(names,{<span class="string">'delta'</span>,<span class="string">'theta'</span>,<span class="string">'alpha'</span>,<span class="string">'beta1'</span>,<span class="string">'beta2'</span>});
0755                 bars = [delta(i), theta(i), alpha(i), beta1(i), beta2(i)];
0756                 h = bar(names,bars,<span class="string">'FaceColor'</span>,<span class="string">'flat'</span>);
0757                 ylim([0 ymax]);
0758                 title(electrodes(i),<span class="string">'FontSize'</span>, 24)
0759                 <span class="comment">% recolor bars</span>
0760                 h.CData(1,:) = [1 0 0];
0761                 h.CData(2,:) = [0.8500 0.3250 0.0980];
0762                 h.CData(3,:) = [0.9290 0.6940 0.1250];
0763                 h.CData(4,:) = [0 1 0];
0764                 h.CData(5,:) = [0.3010 0.7450 0.9330];
0765             <span class="keyword">end</span>
0766             
0767             <span class="comment">% save as img</span>
0768             barsFrame = getframe(barsfig);
0769             barsimg = barsFrame.cdata;
0770         <span class="keyword">end</span>
0771         
0772         <span class="comment">%% Prints recurrence plots for HRV</span>
0773         <span class="comment">%  subjectName: Name of the Subject as String</span>
0774         <span class="comment">%  config: Config</span>
0775         <span class="comment">%  StimuIntName: String</span>
0776         <span class="comment">%  hrvData: HRV values for Subject as double[]</span>
0777         <a name="_sub8" href="#_subfunctions" class="code">function plotHRVRecurrence(self,subject,config,StimuIntName,hrvData,StimuIntDefs)</a>
0778             <span class="comment">% get the timestamps for each interval over the hole timeframe</span>
0779             <span class="comment">% see function for further explanation</span>
0780             [~,StimuIntLabels,intervals,~] = self.calculateStimuIntStartPointsAndIntervals(StimuIntDefs);
0781             plotLenght = length(hrvData);
0782             N = length(hrvData);
0783             S = zeros(N, N);
0784             time = 1:N; <span class="comment">% zeros(N,1);</span>
0785             <span class="comment">%  Calculate time in seconds for x axis</span>
0786             <span class="comment">% for i=1:N</span>
0787             <span class="comment">%     time(i) = round(sum(hrvData(1:i))/1000);</span>
0788             <span class="comment">% end</span>
0789             <span class="comment">% create Recurrence plot</span>
0790             <span class="keyword">for</span> i = 1:N
0791                 S(:,i) = abs( repmat( hrvData(i), N, 1 ) - hrvData(:) );
0792             <span class="keyword">end</span>
0793             fig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0794             set(fig, <span class="string">'PaperType'</span>, <span class="string">'A4'</span>);
0795             set(fig, <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>);            
0796             set(fig, <span class="string">'PaperPosition'</span>, [0.2 0.1 20 29 ]);
0797             subplot(2,1,1);
0798             imagesc(time, time, S);
0799             axis square;
0800             xlabel(<span class="string">'Time [s]'</span>);
0801             ylabel(<span class="string">'Time [s]'</span>);
0802             set(gca,<span class="string">'YDir'</span>,<span class="string">'normal'</span>)            
0803             h = colorbar(<span class="string">'eastoutside'</span>);
0804             freezeColors;
0805             freez = cbfreeze(h);
0806             cblabel(<span class="string">'Time [ms]'</span>);
0807             set(freez, <span class="string">'Position'</span>, [0.75 0.585 0.05 0.34]);
0808             <span class="comment">% get length of Axis</span>
0809             ax = gca;
0810             <span class="comment">% plot marker for the intervals</span>
0811             self.plotIntervals(intervals,[0, ax.YLim(2)],1,[],<span class="string">'r'</span>);
0812             title([<span class="string">'Distance map of '</span> StimuIntName <span class="string">' phase space trajectory for subject'</span> subject.name]);
0813             
0814             <span class="comment">% plot distance map based on Recurrence plot</span>
0815             subplot(2,1,2);
0816             maxDiff = max(max(S) - min(S))*0.001;
0817             <span class="keyword">if</span> (config.RecurrenceThreshold ~= 0)
0818                 maxDiff = config.RecurrenceThreshold; 
0819             <span class="keyword">end</span>
0820             imagesc(time, time, S &lt; 1);
0821             axis square;
0822             colormap([1 1 1;0 0 0]);
0823             xlabel(<span class="string">'Time [s]'</span>);
0824             ylabel(<span class="string">'Time [s]'</span>);
0825             set(gca,<span class="string">'YDir'</span>,<span class="string">'normal'</span>)
0826             self.plotIntervals(intervals,[0, ax.YLim(2)],1,[],<span class="string">'r'</span>);
0827             title([StimuIntName <span class="string">' recurrence plot for subject '</span> subject.name <span class="string">' with threshold '</span> num2str(maxDiff)]);
0828             fName = [subject.OutputDirectory <span class="string">'/'</span> subject.name <span class="string">'_'</span> StimuIntName <span class="string">'_recurrence.pdf'</span>];
0829             print(fName,<span class="string">'-dpdf'</span>,fig);
0830         <span class="keyword">end</span>
0831         
0832         <span class="comment">%% Prints recurrence plots for EDA</span>
0833         <span class="comment">%  subjectName: Name of the Subject as String</span>
0834         <span class="comment">%  config: Config</span>
0835         <span class="comment">%  StimuIntName: String</span>
0836         <span class="comment">%  edaData: EDA values for Subject as double[]</span>
0837         <a name="_sub9" href="#_subfunctions" class="code">function plotEDARecurrence(self,subject,config,StimuInt,edaData,edaDevice)</a>
0838             SamplingRate=edaDevice.samplingRate;
0839             N = length(edaData);
0840             S = zeros(N, N);
0841             time = 1:length(edaData)/SamplingRate;
0842             <span class="comment">% Calculate time in seconds for x axis % Obsolet</span>
0843 <span class="comment">%             for i=1:N</span>
0844 <span class="comment">%                 time(i) = round(sum(edaData(1:i))/5);</span>
0845 <span class="comment">%             end</span>
0846             <span class="keyword">for</span> i = 1:N
0847                 S(:,i) = abs( repmat( edaData(i), N, 1 ) - edaData(:) );
0848             <span class="keyword">end</span>
0849             fig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0850             set(fig, <span class="string">'PaperType'</span>, <span class="string">'A4'</span>);
0851             set(fig, <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>);            
0852             set(fig, <span class="string">'PaperPosition'</span>, [0.2 0.1 20 29 ]);
0853             subplot(2,1,1);
0854             imagesc(time, time, S);
0855             axis square;
0856             xlabel(<span class="string">'Time [s]'</span>);
0857             ylabel(<span class="string">'Time [s]'</span>);
0858             set(gca,<span class="string">'YDir'</span>,<span class="string">'normal'</span>)            
0859             h = colorbar(<span class="string">'eastoutside'</span>);
0860             freezeColors;
0861             freez = cbfreeze(h);
0862             cblabel(<span class="string">'Skin Conductance [µS]'</span>);
0863             set(freez, <span class="string">'Position'</span>, [0.75 0.585 0.05 0.34]);
0864             <span class="comment">% plot marker</span>
0865             ax = gca;
0866             self.plotIntervals(StimuInt.intervals,[0, ax.YLim(2)],1,[],<span class="string">'r'</span>);
0867             title([<span class="string">'Distance map of '</span> StimuInt.stimuIntDescrp <span class="string">' phase space trajectory for subject'</span> subject.name]);    
0868             subplot(2,1,2);
0869             maxDiff = max(max(S) - min(S))*0.001;
0870             <span class="keyword">if</span> (config.RecurrenceThreshold ~= 0)
0871                 maxDiff = config.RecurrenceThreshold; 
0872             <span class="keyword">end</span>
0873             imagesc(time, time, S &lt; 1);
0874             axis square;
0875             colormap([1 1 1;0 0 0]);
0876             xlabel(<span class="string">'Time [s]'</span>);
0877             ylabel(<span class="string">'Time [s]'</span>);
0878             set(gca,<span class="string">'YDir'</span>,<span class="string">'normal'</span>)
0879             <span class="comment">% plot marker</span>
0880             ax = gca;
0881             self.plotIntervals(StimuInt.intervals,[0, ax.YLim(2)],1,[],<span class="string">'r'</span>);
0882             title([StimuInt.stimuIntDescrp <span class="string">' recurrence plot for subject '</span> subject.name <span class="string">' with threshold '</span> num2str(maxDiff)]);
0883             fName = [subject.OutputDirectory <span class="string">'/'</span> subject.name <span class="string">'_EDA_'</span> StimuInt.stimuIntDescrp <span class="string">' _recurrence.pdf'</span>];
0884             print(fName,<span class="string">'-dpdf'</span>,fig);
0885         <span class="keyword">end</span>
0886         
0887         <span class="comment">%% Plots behavioral characteristics % Tim - Code nochmal überschauen</span>
0888         <span class="comment">%  subjectName: String</span>
0889         <span class="comment">%  StimuIntNum: Number of the StimulusInterval</span>
0890         <span class="comment">%  outputDir: Path to output directory as String</span>
0891         <span class="comment">%  frequencies: eeg frequency data for subject as CellArray of double[]</span>
0892         <span class="comment">%  intervals: intervals of interest as int[]</span>
0893         <a name="_sub10" href="#_subfunctions" class="code">function plotBehavioralCharacteristics(self,subjectName,StimuIntNum,outputDir,frequencies,StimuIntDef,eegDevice)</a>
0894             EEGSamplingRate=eegDevice.samplingRate;
0895             intervals = StimuIntDef.intervals;
0896             stimuIntDescrp = StimuIntDef.stimuIntDescrp;
0897             lengthInSeconds = length(frequencies{1,1})/EEGSamplingRate; 
0898             stepWith = 1;
0899             <span class="keyword">if</span> lengthInSeconds &gt; 30
0900                 xName = 0:5:lengthInSeconds;
0901                 stepWith = 5;
0902             <span class="keyword">else</span>
0903                 xName = 0:lengthInSeconds;
0904             <span class="keyword">end</span>
0905             xTime = xName./stepWith; 
0906             absolutValuesPerSecond = zeros(length(frequencies),lengthInSeconds/stepWith); 
0907             [m,n] = size(absolutValuesPerSecond);
0908             <span class="comment">% make values discrete (calculate mean per second)</span>
0909             <span class="keyword">for</span> i=1:m
0910                 start = 1; 
0911                 ende = EEGSamplingRate*stepWith; 
0912                 freqValues = frequencies{:,i}; 
0913                 <span class="keyword">for</span> j=1:n
0914                    absolutValuesPerSecond(i,j) = mean(freqValues(start:ende)); 
0915                    start = start +EEGSamplingRate*stepWith;
0916                    ende = ende +EEGSamplingRate*stepWith; 
0917                 <span class="keyword">end</span>
0918             <span class="keyword">end</span>
0919             <span class="comment">% Normalize percental</span>
0920             valuesToPlot = zeros(m,n);
0921             <span class="comment">% Add TEI values</span>
0922             valuesToPlot(m,:) = absolutValuesPerSecond(m,:);
0923             <span class="keyword">for</span> i=1:m 
0924                 <span class="keyword">for</span> j=1:n
0925                    maxPerSecond = max(absolutValuesPerSecond(:,j));
0926                    maximumPos = absolutValuesPerSecond(:,j) == maxPerSecond;
0927                    valuesToPlot(maximumPos,j) = maxPerSecond/sum(absolutValuesPerSecond(:,j))*100; <span class="comment">% Nomierung ist falsch Gernot Tim</span>
0928                    <span class="comment">%offset = maxPerSecond*90/100; % if a value exists which is 10% smaller then max, show this value in plot</span>
0929                    <span class="comment">%secondValuePos = absolutValuesPerSecond(:,j) &gt;= offset;</span>
0930                    <span class="comment">%if (secondValuePos~=maximumPos)</span>
0931                    <span class="comment">%     valuesToPlot(secondValuePos,j) = absolutValuesPerSecond(secondValuePos,j) / sum(absolutValuesPerSecond(:,j))*100;</span>
0932                    <span class="comment">%end</span>
0933                 <span class="keyword">end</span>
0934             <span class="keyword">end</span>            
0935             fig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0936             colormap jet;
0937             bar(valuesToPlot',<span class="string">'stack'</span>);
0938             grid; 
0939             self.plotIntervals(intervals,[0, 100],stepWith,[],<span class="string">'r'</span>);
0940             title([<span class="string">'Behavioral characteristics for subject'</span> subjectName <span class="string">' '</span> stimuIntDescrp]);
0941             warning(<span class="string">'off'</span>,<span class="string">'MATLAB:legend:IgnoringExtraEntries'</span>); 
0942             legend(<span class="string">'Sleepiness'</span>,<span class="string">'Thinking'</span>,<span class="string">'Relaxation'</span>,<span class="string">'Attention'</span>,<span class="string">'Stress'</span>,<span class="string">'TEI'</span>,<span class="string">'Stimulus'</span>);
0943             warning(<span class="string">'on'</span>,<span class="string">'MATLAB:legend:IgnoringExtraEntries'</span>); 
0944             axis([0 max(xTime)+1 0 100]);
0945             set(gca,<span class="string">'XTick'</span>,xTime,<span class="string">'XTickLabel'</span>,xName);
0946             xlabel(<span class="string">'time [s]'</span>);
0947             ylabel(<span class="string">'[%]'</span>); 
0948             set(fig, <span class="string">'PaperType'</span>, <span class="string">'A4'</span>);
0949             set(fig, <span class="string">'PaperOrientation'</span>, <span class="string">'landscape'</span>);
0950             set(fig, <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>);
0951             set(fig, <span class="string">'PaperPosition'</span>, [0.2 0.1 29 20 ]);
0952             fName = [outputDir <span class="string">'/'</span> subjectName <span class="string">'_'</span> stimuIntDescrp <span class="string">'_characteristics.pdf'</span>];
0953             print(fName,<span class="string">'-dpdf'</span>,fig);
0954             close(fig);
0955         <span class="keyword">end</span>      
0956         
0957         <span class="comment">%% Plots hrv data</span>
0958         <span class="comment">%  hrvValues: hrvValues for Subject as double[]</span>
0959         <span class="comment">%  outputDir: Path to output directory as String</span>
0960         <span class="comment">%  subjName: The name of the Subject</span>
0961         <span class="comment">%  StimuIntDef: StimulusInterval Definition</span>
0962         <a name="_sub11" href="#_subfunctions" class="code">function plotHRV(self,hrvValues,outputDir,subjName,StimuIntDef)</a>
0963             fig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0964             N = length(hrvValues);
0965             time = 1:N;
0966             <span class="comment">% plot values</span>
0967             plot(hrvValues,<span class="string">'k'</span>);
0968             grid;
0969             yMin = min(hrvValues);
0970             yMax = max(hrvValues);
0971             <span class="comment">% get values for intervals over hole time frame with starting</span>
0972             <span class="comment">% points, to plot marker on each Stimulus</span>
0973             [StimuIntStartPoints,StimuIntTyps,intervals,~] = self.calculateStimuIntStartPointsAndIntervals(StimuIntDef);
0974             
0975             <span class="comment">% get index and length of EDA Orientation, to build HRV</span>
0976             <span class="comment">% Baseline</span>
0977             <span class="keyword">for</span> i = 1:length(StimuIntDef)
0978                 <span class="keyword">if</span> StimuIntDef{1, i}.stimuIntType == 0
0979                     index = i;
0980                     StimuIntLength = StimuIntDef{1, i}.Stimulength;
0981                 <span class="keyword">end</span>
0982             <span class="keyword">end</span>
0983             <span class="comment">% calculate the HRV Baseline</span>
0984             BaselineSignal = mean(hrvValues(ceil(StimuIntStartPoints(index)):round(StimuIntStartPoints(index))+StimuIntLength));
0985             
0986             self.plotIntervals(intervals,[yMin, yMax],1,[],<span class="string">'r'</span>);
0987             self.plotStimuIntStartPoints(StimuIntStartPoints,StimuIntTyps,[yMin, yMax],1);
0988             yline(BaselineSignal,<span class="string">'-g'</span>);
0989             axis([1 max(time) yMin yMax]);
0990             ylabel(<span class="string">'RR intervals [ms]'</span>);
0991             xlabel(<span class="string">'time [s]'</span>);
0992             m = sprintf(<span class="string">'%.2f'</span>,mean(hrvValues));
0993             sd = sprintf(<span class="string">'%.2f'</span>,std(hrvValues));
0994             hold on
0995             
0996             <span class="comment">% create custom legend</span>
0997             h = zeros(4,1);
0998             h(1) = plot(NaN,NaN,<span class="string">'-k'</span>);
0999             h(2) = plot(NaN,NaN,<span class="string">'-g'</span>);
1000             h(3) = plot(NaN,NaN,<span class="string">'-r'</span>);
1001             h(4) = plot(NaN,NaN,<span class="string">'-b'</span>);
1002             
1003             legend(h,<span class="string">'HRV Signal'</span>, <span class="string">'Baseline'</span>, <span class="string">'Marker'</span>, <span class="string">'Stimuli'</span>,<span class="string">'location'</span>,<span class="string">'northeastoutside'</span>)
1004             
1005             title({[<span class="string">'HRV values for subject '</span> subjName <span class="string">' (mean='</span> m <span class="string">'ms, sd='</span> sd <span class="string">'ms)'</span>],<span class="string">''</span>});
1006             set(fig, <span class="string">'PaperType'</span>, <span class="string">'A4'</span>);
1007             set(fig, <span class="string">'PaperOrientation'</span>, <span class="string">'landscape'</span>);
1008             set(fig, <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>);
1009             set(fig, <span class="string">'PaperPosition'</span>, [0.2 0.1 29 20 ]);
1010             fName = [outputDir <span class="string">'/'</span> subjName <span class="string">'_HRV.pdf'</span>];
1011             print(fName,<span class="string">'-dpdf'</span>,fig);
1012             close(fig);
1013         <span class="keyword">end</span>   
1014         
1015         <span class="comment">%% RawEEG figure plot</span>
1016         <span class="comment">%   get rawEEG data and plot it</span>
1017         <span class="comment">%   rawValues: Raw eeg values as double[]</span>
1018         <span class="comment">%   filteredValues: Filteres eeg values as double[]</span>
1019         <span class="comment">%   quality: Two double values. First is percent outside for</span>
1020         <span class="comment">%   rawValues. Second is percent outside for filtered values</span>
1021         <span class="comment">%   subject: Data of Subject</span>
1022         <span class="comment">%   config: Config</span>
1023         <a name="_sub12" href="#_subfunctions" class="code">function plotRawEEGFigures(self,rawValues,filteredValues,quality,subject,electrode,config)</a>
1024             numRawValues = length(rawValues);
1025             numFilteredValues = length(filteredValues);
1026             fig = figure(<span class="string">'visible'</span>, <span class="string">'off'</span>);
1027             subplot(2,1,1);
1028             plot(rawValues);
1029             grid;
1030             hold on;
1031             line(<span class="string">'XData'</span>,[0 numRawValues],<span class="string">'YData'</span>,[config.LowerThreshold config.LowerThreshold],<span class="string">'Color'</span>,<span class="string">'r'</span>)
1032             line(<span class="string">'XData'</span>,[0 numRawValues],<span class="string">'YData'</span>,[config.UpperThreshold config.UpperThreshold],<span class="string">'Color'</span>,<span class="string">'r'</span>)
1033             hold off;
1034             thresholdString = [<span class="string">'['</span> num2str(config.LowerThreshold) <span class="string">','</span> num2str(config.UpperThreshold) <span class="string">']'</span>];
1035             title ([<span class="string">'Unfiltered EEG raw data for electrode '</span> char(electrode) <span class="string">' of subject '</span> subject.name <span class="string">' ('</span> sprintf(<span class="string">'%3.2f'</span>,quality(1)) <span class="string">'% of data lies outside the interval '</span> thresholdString <span class="string">'µV)'</span>])
1036             ylabel(<span class="string">'amplitude [µV]'</span>);
1037             xlabel(<span class="string">'data point [#]'</span>);
1038             axis([1 numRawValues min(rawValues) max(rawValues)])
1039             set(gca,<span class="string">'YDir'</span>,<span class="string">'reverse'</span>);
1040             subplot(2,1,2);
1041             plot(filteredValues);
1042             grid;
1043             hold on;
1044             line(<span class="string">'XData'</span>,[0 numFilteredValues],<span class="string">'YData'</span>,[config.LowerThreshold config.LowerThreshold],<span class="string">'Color'</span>,<span class="string">'r'</span>)
1045             line(<span class="string">'XData'</span>,[0 numFilteredValues],<span class="string">'YData'</span>,[config.UpperThreshold config.UpperThreshold],<span class="string">'Color'</span>,<span class="string">'r'</span>)
1046             hold off;
1047             title ([<span class="string">'Filtered EEG raw data for subject '</span>, subject.name ,<span class="string">' ('</span>,sprintf(<span class="string">'%3.2f'</span>,quality(2)),<span class="string">'% of data lies outside the interval '</span> thresholdString <span class="string">'µV)'</span>])
1048             ylabel(<span class="string">'amplitude [µV]'</span>)
1049             xlabel(<span class="string">'data point [#]'</span>);
1050             axis([1 numFilteredValues min(rawValues) max(rawValues)])
1051             set(gca,<span class="string">'YDir'</span>,<span class="string">'reverse'</span>);
1052             set(fig, <span class="string">'PaperType'</span>, <span class="string">'A4'</span>);
1053             set(fig, <span class="string">'PaperOrientation'</span>, <span class="string">'landscape'</span>);
1054             set(fig, <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>);
1055             set(fig, <span class="string">'PaperPosition'</span>, [0.2 0.1 29 20 ]);
1056             print([subject.OutputDirectory <span class="string">'/'</span> subject.name <span class="string">'_'</span> char(electrode) <span class="string">'_EEG.pdf'</span>],<span class="string">'-dpdf'</span>,fig);
1057             close(fig);
1058         <span class="keyword">end</span> 
1059      
1060         <span class="comment">%% Plots EDA figures for given Stimulus Intervals</span>
1061         <span class="comment">%   StimuIntIndex: StimulusInterval indicies of StimulusIntervals to plot as doubel[]</span>
1062         <span class="comment">%   edaValues: eda values of subject as Cell of double[]</span>
1063         <span class="comment">%   StimuIntDefs: Cell&lt;StimuIntDefinition&gt;</span>
1064         <span class="comment">%   subjectName: the name of the subject as String</span>
1065         <span class="comment">%   fPath: file path as String</span>
1066         <span class="comment">%   stats: eda statistics for subject as String</span>
1067         <a name="_sub13" href="#_subfunctions" class="code">function plotSubStimuIntEDA(self,StimuIntIndex,edaValues,StimuIntDefs,subjectName,fPath,stats)</a>
1068             fig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>);
1069             allValues=  edaValues(StimuIntIndex);
1070             allValues = vertcat(allValues{:});
1071             yMin = min(allValues);
1072             yMax = max(allValues);
1073             yL = [yMin yMax];
1074             subplotCounter = 1;
1075             <span class="comment">% choose x axis interval on base of StimulusInterval length</span>
1076             <span class="keyword">for</span> i = StimuIntIndex
1077                 StimuIntType = StimuIntDefs{1,i}(1);
1078                 StimuIntLength = StimuIntDefs{i}.Stimulength;
1079                 labels = [];
1080                 <span class="comment">% get x Axis for long and short Stimulus Intervals</span>
1081                 <span class="keyword">if</span> StimuIntLength &gt; 30
1082                     xAxis = 0:5:StimuIntLength;
1083                     labels = StimuIntDefs{i}.intervals;
1084                 <span class="keyword">else</span>
1085                     xAxis = 0:StimuIntLength;
1086                 <span class="keyword">end</span>
1087                 xTime = xAxis .* 5;
1088                 subplot(6,1,subplotCounter);
1089                 subplotCounter = subplotCounter + 1;
1090                 plot(edaValues{i},<span class="string">'k'</span>);
1091                 <span class="comment">% plot marker on EDA plot</span>
1092                 self.plotIntervals(StimuIntDefs{i}.intervals,yL,max(xTime)/max(xAxis),labels,<span class="string">'r'</span>);
1093                 grid;
1094                 ylabel([StimuIntType.stimuIntDescrp <span class="string">' [µS]'</span>]);
1095                 l = length(edaValues{i});
1096                 axis([1,l, yL]);
1097                 set(gca,<span class="string">'XTick'</span>,xTime,<span class="string">'XTickLabel'</span>,xAxis);
1098                 <span class="keyword">if</span> (i==1)
1099                     title([<span class="string">'Overview of all EDA values from all related StimulusInterval of subject '</span> subjectName]);
1100                 <span class="keyword">end</span>
1101             <span class="keyword">end</span>
1102             xlabel(<span class="string">'Time [s]'</span>);
1103             axes(<span class="string">'Position'</span>,[.08 .10 0.8 1],<span class="string">'Visible'</span>,<span class="string">'off'</span>); <span class="comment">% Tim Position Hardcoded bei mehr Stimus kommt es zu Problemen!</span>
1104             text(0,0,stats,<span class="string">'FontName'</span>,<span class="string">'FixedWidth'</span>,<span class="string">'FontSize'</span>,8);
1105             set(fig, <span class="string">'PaperType'</span>, <span class="string">'A4'</span>);
1106             set(fig, <span class="string">'PaperOrientation'</span>, <span class="string">'portrait'</span>);
1107             set(fig, <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>);
1108             set(fig, <span class="string">'PaperPositionMode'</span>, <span class="string">'auto'</span>);
1109             set(fig, <span class="string">'PaperPosition'</span>, [0.2 0.2 20 29 ]);
1110             print(fPath,<span class="string">'-dpdf'</span>,fig);
1111             close(fig);
1112         <span class="keyword">end</span>
1113         
1114         <span class="comment">%% Plots complete EDA figure to given file name</span>
1115         <span class="comment">%   StimuIntDef: Cell&lt;StimuIntDefinition&gt;</span>
1116         <span class="comment">%   fPath: Output file path</span>
1117         <span class="comment">%   edaValues: EDA values as double[]</span>
1118         <span class="comment">%   detrended: boolean</span>
1119         <a name="_sub14" href="#_subfunctions" class="code">function plotEDA(self,StimuIntDef,fPath,edaValues,detrended)</a>
1120             <span class="comment">% get scale and interval, starting points and Stimulus Interval</span>
1121             <span class="comment">% typs</span>
1122             maxscale = max(edaValues);
1123             minscale = min(edaValues);
1124             [StimuIntStartPoints,StimuIntTyps,intervals,completeVidLength] = self.calculateStimuIntStartPointsAndIntervals(StimuIntDef);
1125             xAxis = 0:10:completeVidLength;
1126             xTime = xAxis .* 5;
1127             fig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>);
1128             plot(edaValues,<span class="string">'k'</span>);
1129             grid;
1130             axis([1 length(edaValues) minscale maxscale]);
1131             set(gca,<span class="string">'XTick'</span>,xTime,<span class="string">'XTickLabel'</span>,xAxis);
1132             xlabel(<span class="string">'Time [s]'</span>);
1133             self.plotIntervals(intervals,[minscale, maxscale],max(xTime)/max(xAxis),[],<span class="string">'r'</span>);
1134             self.plotStimuIntStartPoints(StimuIntStartPoints,StimuIntTyps,[minscale, maxscale],max(xTime)/max(xAxis));
1135             ylabel(<span class="string">'Skin Conductance [µS]'</span>);
1136             <span class="comment">% check for detrended data</span>
1137             <span class="keyword">if</span> (detrended)
1138                 t = <span class="string">'EDA values (detrended)'</span>;
1139             <span class="keyword">else</span>
1140                 t = <span class="string">'EDA values'</span>;
1141             <span class="keyword">end</span>
1142             title({t,<span class="string">''</span>});
1143             set(fig, <span class="string">'PaperType'</span>, <span class="string">'A4'</span>);
1144             set(fig, <span class="string">'PaperOrientation'</span>, <span class="string">'landscape'</span>);
1145             set(fig, <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>);
1146             set(fig, <span class="string">'PaperPositionMode'</span>, <span class="string">'auto'</span>);
1147             set(fig, <span class="string">'PaperPosition'</span>, [0.2 0.1 29 20 ]);
1148             print(fPath,<span class="string">'-dpdf'</span>,fig);
1149             close(fig);
1150         <span class="keyword">end</span>
1151         
1152         <span class="comment">%% Plots eeg frequency bands for StimulusInterval and each frequency band</span>
1153         <span class="comment">%   StimuIntLength: Length of the StimulusInterval in seconds as double</span>
1154         <span class="comment">%   fPath: Output file path as String</span>
1155         <span class="comment">%   theta_s: Theta values as double[]</span>
1156         <span class="comment">%   alpha_s: Alpha values as double[]</span>
1157         <span class="comment">%   beta1_s: Beta1 values as double[]</span>
1158         <span class="comment">%   beta2_s: Beta2 values as double[]</span>
1159         <span class="comment">%   task_s: TEI values as double[]</span>
1160         <span class="comment">%   resolution: values per second as double</span>
1161         <span class="comment">%   intervals: intervals of interest as int[]</span>
1162         <span class="comment">%   edaSubStimuIntList: EDA values of StimulusInterval as double[]</span>
1163         <a name="_sub15" href="#_subfunctions" class="code">function plotFrequencys(self,StimuIntLength,fPath,theta_s,alpha_s,beta1_s,beta2_s,task_s,resolution,StimuIntDef,edaSubStimuIntList)</a>
1164             intervals = StimuIntDef.intervals;
1165             fig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>);
1166             maxscale = max([max(theta_s) max(alpha_s) max(beta1_s) max(beta2_s) ]);
1167             labels = [];
1168             <span class="comment">% get x Axis for long and short Stimulus Intervals and xAxis</span>
1169             <span class="comment">% labels for interval if necessary</span>
1170             <span class="keyword">if</span> StimuIntLength &gt; 30
1171                 xAxis = 0:5:StimuIntLength;
1172                 labels = intervals;
1173             <span class="keyword">else</span>
1174                 xAxis = 0:StimuIntLength;
1175             <span class="keyword">end</span>
1176             xtime = xAxis .* resolution;
1177             edaXTime = xAxis .* 5;
1178             
1179             <span class="comment">% create each subplot for the each frequency band and plot them</span>
1180             <span class="comment">% in different colors</span>
1181             subplot(6,1,1);
1182             plot(theta_s,<span class="string">'Color'</span>,[0/255 191/255 255/255]);
1183             self.plotIntervals(intervals,[0, maxscale],max(xtime)/max(xAxis),labels,<span class="string">'r'</span>);
1184             grid;
1185             ylabel(<span class="string">'Theta [µV]'</span>);
1186             axis([1 length(theta_s) 0 maxscale]);
1187             set(gca,<span class="string">'XTick'</span>,xtime,<span class="string">'XTickLabel'</span>,xAxis);
1188             <span class="comment">% set path and titel once for the pdf</span>
1189             [~,subjName,~] = fileparts(fPath);
1190             t = title({[<span class="string">'Frequency bands, task engagement and EDA for subject: '</span> strrep(subjName,<span class="string">'_freq_bands_'</span>,<span class="string">' '</span>)],<span class="string">''</span>});
1191             tP = get(t,<span class="string">'Position'</span>);
1192             set(t,<span class="string">'Position'</span>,[tP(1) tP(2)+0.3 tP(3)]);
1193             set(t,<span class="string">'FontSize'</span>,12);
1194             
1195             subplot(6,1,2);
1196             plot(alpha_s,<span class="string">'Color'</span>,[0/255 128/255 0/255]);
1197             self.plotIntervals(intervals,[0, maxscale],max(xtime)/max(xAxis),labels,<span class="string">'r'</span>);
1198             grid;
1199             ylabel(<span class="string">'Alpha [µV]'</span>);
1200             axis([1 length(alpha_s) 0 maxscale]);
1201             set(gca,<span class="string">'XTick'</span>,xtime,<span class="string">'XTickLabel'</span>,xAxis);
1202             
1203             subplot(6,1,3);
1204             plot(beta1_s,<span class="string">'Color'</span>,[255/255 128/255 0/255]);
1205             self.plotIntervals(intervals,[0, maxscale],max(xtime)/max(xAxis),labels,<span class="string">'r'</span>);
1206             grid;
1207             ylabel(<span class="string">'Beta1 [µV]'</span>);
1208             axis([1 length(beta1_s) 0 maxscale]);
1209             set(gca,<span class="string">'XTick'</span>,xtime,<span class="string">'XTickLabel'</span>,xAxis);
1210             
1211             subplot(6,1,4);
1212             plot(beta2_s,<span class="string">'Color'</span>,[255/255 69/255 0/255]);
1213             self.plotIntervals(intervals,[0, maxscale],max(xtime)/max(xAxis),labels,<span class="string">'r'</span>);
1214             set(gca,<span class="string">'XTick'</span>,xtime,<span class="string">'XTickLabel'</span>,xAxis);
1215             grid;
1216             ylabel(<span class="string">'Beta2 [µV]'</span>);
1217             axis([1 length(beta2_s) 0 maxscale]);
1218             set(gca,<span class="string">'XTick'</span>,xtime,<span class="string">'XTickLabel'</span>,xAxis);
1219             
1220             subplot(6,1,5);
1221             plot(task_s,<span class="string">'k'</span>);
1222             self.plotIntervals(intervals,[0, max(task_s)],max(xtime)/max(xAxis),labels,<span class="string">'r'</span>);
1223             grid;
1224             ylabel(<span class="string">'TEI'</span>);
1225             axis([1 length(task_s) 0 max(task_s)]);
1226             set(gca,<span class="string">'XTick'</span>,xtime,<span class="string">'XTickLabel'</span>,xAxis);
1227             
1228             subplot(6,1,6);
1229             plot(edaSubStimuIntList,<span class="string">'k'</span>);
1230             yL = [min(edaSubStimuIntList) max(edaSubStimuIntList)];
1231             self.plotIntervals(intervals,yL,max(edaXTime)/max(xAxis),labels,<span class="string">'r'</span>);
1232             grid;
1233             ylabel(<span class="string">'EDA [µS]'</span>);
1234             l = length(edaSubStimuIntList);
1235             axis([1,l, yL]);
1236             set(gca,<span class="string">'XTick'</span>,edaXTime,<span class="string">'XTickLabel'</span>,xAxis);
1237 
1238             set(fig, <span class="string">'PaperType'</span>, <span class="string">'A4'</span>);
1239             set(fig, <span class="string">'PaperOrientation'</span>, <span class="string">'portrait'</span>);
1240             set(fig, <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>);
1241             set(fig, <span class="string">'PaperPositionMode'</span>, <span class="string">'auto'</span>);
1242             set(fig, <span class="string">'PaperPosition'</span>, [0.2 0.1 20 29 ]);
1243             print([<span class="string">'-f'</span>,int2str(fig.Number)],<span class="string">'-dpdf'</span>,[fPath,<span class="string">'.pdf'</span>]);
1244             close(fig);
1245         <span class="keyword">end</span>
1246                
1247         <span class="comment">%% Plots eeg frequency bands for StimulusInterval and each frequency band</span>
1248         <span class="comment">%   StimuIntLength: Length in seconds as double</span>
1249         <span class="comment">%   fPath: Path to output file as String</span>
1250         <span class="comment">%   theta_s: Theta values as double[]</span>
1251         <span class="comment">%   alpha_s: Alpha values as double[]</span>
1252         <span class="comment">%   beta1_s: Beta1 values as double[]</span>
1253         <span class="comment">%   beta2_s: Beta2 values as double[]</span>
1254         <span class="comment">%   task_s: TEI values as double[]</span>
1255         <span class="comment">%   baselineTheta: Baseline values for theta as double[]</span>
1256         <span class="comment">%   baselineAlpha: Baseline values for alpha as double[]</span>
1257         <span class="comment">%   baselineBeta1: Baseline values for beta1 as double[]</span>
1258         <span class="comment">%   baselineBeta2: Baseline values for beta2 as double[]</span>
1259         <span class="comment">%   baselineTEI: Baseline values for TEI as double[]</span>
1260         <span class="comment">%   resolution: values per second as double</span>
1261         <span class="comment">%   intervals: intervals of interest as int[]</span>
1262         <span class="comment">%   t_title: Diagramm title as String</span>
1263         <a name="_sub16" href="#_subfunctions" class="code">function plotFrequencysWithBaselineMagnitude(self,StimuIntLength,fPath,theta_s,alpha_s,beta1_s,beta2_s,task_s,baselineTheta,baselineAlpha,baselineBeta1,baselineBeta2,baselineTEI,resolution,intervals,t_title)</a>
1264             fig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>);
1265             <span class="comment">% Scaling factor to extend the y axis for the legend</span>
1266             scaleFactor = 1.7;
1267             maxscale = scaleFactor*(max([max(alpha_s) max(beta1_s) max(beta2_s) max(theta_s)])); <span class="comment">% Add 50% (1.5) to the maxscale for providing more space for the legend</span>
1268             numDataPoints = StimuIntLength*resolution;
1269             labels = [];
1270             <span class="comment">% get x Axis for long and short Stimulus Intervals and xAxis</span>
1271             <span class="comment">% labels for interval if necessary</span>
1272             <span class="keyword">if</span> StimuIntLength &gt; 30
1273                 xname = 0:5:StimuIntLength;
1274                 labels = intervals;
1275             <span class="keyword">else</span>
1276                 xname = 0:StimuIntLength;
1277             <span class="keyword">end</span>
1278             xtime = xname .* resolution;
1279             
1280             <span class="comment">% subplots for each frequency band with own color</span>
1281             subplot(6,1,1)
1282             hold on
1283             plot(theta_s,<span class="string">'Color'</span>,[65/255 105/255 225/255]);
1284             m = mean(baselineTheta);
1285             line(<span class="string">'XData'</span>,[0 xtime(end)],<span class="string">'YData'</span>,[m,m],<span class="string">'Color'</span>,<span class="string">'b'</span>)
1286             <span class="comment">% print marker on plot for each Stimulus Interval</span>
1287             self.plotIntervals(intervals,[0, maxscale],max(xtime)/max(xname),labels,<span class="string">'r'</span>);
1288             grid;
1289             hold off
1290             massAndTime = self.calculateMassAndTime(theta_s,numDataPoints,mean(baselineTheta));
1291             
1292             <span class="keyword">if</span>(isempty(intervals))
1293                 legend(massAndTime,<span class="string">'theta baseline average'</span>);
1294             <span class="keyword">else</span>
1295                 h=legend(massAndTime,<span class="string">'theta baseline average'</span>,<span class="string">'Stimulus'</span>);
1296             <span class="keyword">end</span>
1297             ylabel(<span class="string">'Theta [µV]'</span>);
1298             axis([0 length(theta_s) 0 maxscale]);
1299             set(gca,<span class="string">'XTick'</span>,xtime,<span class="string">'XTickLabel'</span>,xname);
1300             
1301             <span class="comment">% title for the hole plot</span>
1302             title(t_title);
1303             
1304             subplot(6,1,2);
1305             hold on;
1306             plot(alpha_s,<span class="string">'Color'</span>,[0/255 128/255 0/255]);
1307             m = mean(baselineAlpha);
1308             line(<span class="string">'XData'</span>,[0 xtime(end)],<span class="string">'YData'</span>,[m,m],<span class="string">'Color'</span>,<span class="string">'b'</span>)
1309             self.plotIntervals(intervals,[0, maxscale],max(xtime)/max(xname),labels,<span class="string">'r'</span>);
1310             hold off;
1311             massAndTime = self.calculateMassAndTime(alpha_s,numDataPoints,mean(baselineAlpha));
1312             <span class="keyword">if</span>(isempty(intervals))
1313                 legend(massAndTime,<span class="string">'alpha baseline average'</span>);
1314             <span class="keyword">else</span>
1315                 h= legend(massAndTime,<span class="string">'alpha baseline average'</span>,<span class="string">'Stimulus'</span>);
1316             <span class="keyword">end</span>
1317             grid;
1318             ylabel(<span class="string">'Alpha [µV]'</span>);
1319             axis([0 length(alpha_s) 0 maxscale]);
1320             set(gca,<span class="string">'XTick'</span>,xtime,<span class="string">'XTickLabel'</span>,xname);
1321                         
1322             subplot(6,1,3);
1323             hold on;
1324             plot(beta1_s,<span class="string">'Color'</span>,[255/255 128/255 0/255]);
1325             m = mean(baselineBeta1);
1326             line(<span class="string">'XData'</span>,[0 xtime(end)],<span class="string">'YData'</span>,[m,m],<span class="string">'Color'</span>,<span class="string">'b'</span>)
1327             self.plotIntervals(intervals,[0, maxscale],max(xtime)/max(xname),labels,<span class="string">'r'</span>);
1328             massAndTime = self.calculateMassAndTime(beta1_s,numDataPoints,mean(baselineBeta1));
1329             hold off;
1330             <span class="keyword">if</span>(isempty(intervals))
1331                 legend(massAndTime,<span class="string">'beta1 baseline average'</span>);
1332             <span class="keyword">else</span>
1333                 h= legend(massAndTime,<span class="string">'beta1 baseline average'</span>,<span class="string">'Stimulus'</span>);
1334             <span class="keyword">end</span>
1335             grid;
1336             ylabel(<span class="string">'Beta1 [µV]'</span>);
1337             axis([0 length(beta1_s) 0 maxscale]);
1338             set(gca,<span class="string">'XTick'</span>,xtime,<span class="string">'XTickLabel'</span>,xname);
1339             
1340             subplot(6,1,4);
1341             hold on;
1342             plot(beta2_s,<span class="string">'Color'</span>,[255/255 69/255 0/255]);
1343             m = mean(baselineBeta2);
1344             line(<span class="string">'XData'</span>,[0 xtime(end)],<span class="string">'YData'</span>,[m,m],<span class="string">'Color'</span>,<span class="string">'b'</span>)
1345             massAndTime = self.calculateMassAndTime(beta2_s,numDataPoints,mean(baselineBeta2));
1346             self.plotIntervals(intervals,[0, maxscale],max(xtime)/max(xname),labels,<span class="string">'r'</span>);
1347             hold off;
1348             <span class="keyword">if</span>(isempty(intervals))
1349                 legend(massAndTime,<span class="string">'beta2 baseline average'</span>);
1350             <span class="keyword">else</span>
1351                 h=legend(massAndTime,<span class="string">'beta2 baseline average'</span>,<span class="string">'Stimulus'</span>);
1352             <span class="keyword">end</span>
1353             grid;
1354             ylabel(<span class="string">'Beta2 [µV]'</span>);
1355             axis([0 length(beta2_s) 0 maxscale]);
1356             set(gca,<span class="string">'XTick'</span>,xtime,<span class="string">'XTickLabel'</span>,xname);
1357             
1358             subplot(6,1,5);
1359             hold on;
1360             plot(task_s,<span class="string">'k'</span>);
1361             m = mean(baselineTEI);
1362             line(<span class="string">'XData'</span>,[0 xtime(end)],<span class="string">'YData'</span>,[m,m],<span class="string">'Color'</span>,<span class="string">'b'</span>)
1363             <span class="comment">% the max scale for task band is different and has to be</span>
1364             <span class="comment">% calculated separately</span>
1365             maxscaleTask = scaleFactor*max(task_s);
1366             massAndTime = self.calculateMassAndTime(task_s,numDataPoints,mean(baselineTEI));
1367             self.plotIntervals(intervals,[0, maxscaleTask],max(xtime)/max(xname),labels,<span class="string">'r'</span>);
1368             hold off;
1369             <span class="keyword">if</span>(isempty(intervals))
1370                 legend(massAndTime,<span class="string">'TEI baseline average'</span>);
1371             <span class="keyword">else</span>
1372                 legend(massAndTime,<span class="string">'TEI baseline average'</span>,<span class="string">'Stimulus'</span>);
1373             <span class="keyword">end</span>
1374             grid;
1375             ylabel(<span class="string">'TEI'</span>);
1376             axis([0 length(task_s) 0 maxscaleTask]);
1377             set(gca,<span class="string">'XTick'</span>,xtime,<span class="string">'XTickLabel'</span>,xname);
1378                         
1379             set(fig, <span class="string">'PaperType'</span>, <span class="string">'A4'</span>);
1380             set(fig, <span class="string">'PaperOrientation'</span>, <span class="string">'portrait'</span>);
1381             set(fig, <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>);
1382             set(fig, <span class="string">'PaperPositionMode'</span>, <span class="string">'auto'</span>);
1383             set(fig, <span class="string">'PaperPosition'</span>, [0.2 0.1 20 29 ]);
1384             print([<span class="string">'-f'</span>,int2str(fig.Number)],<span class="string">'-dpdf'</span>,fPath);
1385             close(fig);
1386         <span class="keyword">end</span>
1387     <span class="keyword">end</span>
1388     
1389     methods(Access=private)   
1390         
1391         <span class="comment">%% Helper method to calculate mass and time</span>
1392         <a name="_sub17" href="#_subfunctions" class="code">function massAndTime = calculateMassAndTime(self,values,numDataPoints, mean)</a>
1393             valuesOverMean = find(values &gt; mean);
1394             overCount = length(valuesOverMean);
1395             overMass = sum(values(valuesOverMean));
1396             mass = int8(overMass/sum(values)*100);
1397             time = int8(overCount/numDataPoints*100);
1398             massAndTime = [num2str(time) <span class="string">'% time | '</span> num2str(mass) <span class="string">'% weighted mass is over baseline'</span>];
1399         <span class="keyword">end</span>
1400         
1401         <span class="comment">%% Helper method to calculate intervals and StimulusInterval start points</span>
1402         <span class="comment">%  Import the Stimulus Interval Definition Cell Array and extract</span>
1403         <span class="comment">% the individual intervals to convert them into an interval vector</span>
1404         <span class="comment">% over the whole timeframe of the data</span>
1405         <a name="_sub18" href="#_subfunctions" class="code">function [StimuIntStartPoints,StimuIntLabels,intervals,completeVidLength] = calculateStimuIntStartPointsAndIntervals(self,StimuIntDef)</a>
1406             StimuIntStartPoints = [];
1407             StimuIntLabels={};
1408             intervals = [];
1409             completeVidLength =0;
1410             <span class="keyword">for</span> i=1:length(StimuIntDef)
1411                 completeVidLength = completeVidLength + StimuIntDef{i}.Stimulength;
1412                 StimuIntLabels{i} = StimuIntDef{1, i}.stimuIntDescrp;
1413                 <span class="comment">% Starting value needs to be != 0, because of calculations</span>
1414                 <span class="comment">% later on -&gt; changed from 0 -&gt; 0.2</span>
1415                 <span class="keyword">if</span> i==1
1416                     StimuIntStartPoints(i) = 0.2;
1417                 <span class="comment">% the second value must be used separately,</span>
1418                 <span class="comment">% because of the exchange of 0 -&gt; 0.2</span>
1419                 <span class="keyword">elseif</span> i == 2
1420                     StimuIntStartPoints(i) = StimuIntDef{i-1}.Stimulength;
1421                 <span class="comment">% then the values can simply be added up</span>
1422                 <span class="keyword">else</span>
1423                     StimuIntStartPoints(i) = StimuIntDef{i-1}.Stimulength + StimuIntStartPoints(i-1);
1424                 <span class="keyword">end</span>
1425                 currentIntervals = StimuIntDef{i}.intervals;
1426                 currentIntervals= currentIntervals + StimuIntStartPoints(i);
1427                 intervals = horzcat(intervals,currentIntervals');
1428             <span class="keyword">end</span>
1429         <span class="keyword">end</span>
1430         
1431         <span class="comment">%% Helper method to plot intervals of interest</span>
1432         <a name="_sub19" href="#_subfunctions" class="code">function plotIntervals(self,intervals,yPos,scaleFac,labels,color)</a>
1433             labels = labels';
1434             <span class="keyword">for</span> i=1:length(intervals)
1435                 xPosition = intervals(i);
1436                 xPosition = xPosition*double(scaleFac);
1437                 line([double(xPosition) double(xPosition)],yPos,<span class="string">'Color'</span>,color);
1438                 <span class="comment">% only used if the graph does not contain all distances</span>
1439                 <span class="keyword">if</span> ~isempty(labels)
1440                     text([double(xPosition) double(xPosition)],[yPos(2) yPos(2)], num2str(labels(i)), <span class="string">'VerticalAlignment'</span>,<span class="string">'bottom'</span>,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="string">'FontSize'</span>,8);
1441                 <span class="keyword">end</span>
1442             <span class="keyword">end</span>
1443         <span class="keyword">end</span>
1444         
1445         <span class="comment">%% Helper method to plot the StimulusInterval start points</span>
1446         <a name="_sub20" href="#_subfunctions" class="code">function plotStimuIntStartPoints(self,startPoints,labels,yPos,scaleFac)</a>
1447             <span class="keyword">for</span> i=1:length(startPoints)
1448                 xPosition = startPoints(i);
1449                 xPosition = double(xPosition*scaleFac);
1450                 line([xPosition xPosition],yPos,<span class="string">'Color'</span>,<span class="string">'b'</span>,<span class="string">'LineStyle'</span>,<span class="string">'--'</span>);
1451                 t = text([xPosition xPosition],[yPos(2) yPos(2)], labels(i), <span class="string">'VerticalAlignment'</span>,<span class="string">'top'</span>,<span class="string">'HorizontalAlignment'</span>,<span class="string">'right'</span>,<span class="string">'FontSize'</span>,9);
1452                 set(t,<span class="string">'Rotation'</span>,90);
1453             <span class="keyword">end</span>
1454         <span class="keyword">end</span>
1455         
1456         <span class="comment">%% Plots quality index figures for subjects and StimulusIntervals</span>
1457         <span class="comment">%   unfilteredQuality: Percentage of unfiltered eeg values outside interval for each subject</span>
1458         <span class="comment">%   and StimuInt as double[][]</span>
1459         <span class="comment">%   filteredQuality: Percentage of filtered eeg values outside interval for each subject</span>
1460         <span class="comment">%   and StimuInt as double[][]</span>
1461         <span class="comment">%   validStimuIntsPerSubject: Number of valid baseline eeg, tv</span>
1462         <span class="comment">%   programm and tv commercial StimulusIntervals per subject as double[][]</span>
1463         <span class="comment">%   validSubjects: Total number of valid subjects as double</span>
1464         <span class="comment">%   StimuIntDefs: StimulusInterval definitions as Cell&lt;StimuIntDef&gt;</span>
1465         <span class="comment">%   config: Config</span>
1466         <span class="comment">%   numSubjects: total number of subjects as double</span>
1467         
1468 <span class="comment">%         Kreitzberg: Commented out, until functionality and usecase is declared</span>
1469 <span class="comment">%         or function is change</span>
1470         
1471 <span class="comment">%         function plotEEGQualityFigures(self,unfilteredQuality,filteredQuality,validStimuIntsPerSubject,validSubjects,StimuIntDefs,config,numSubjects) %Tim ID 12 plot of QualityFigs</span>
1472 <span class="comment">%             StimuIntIndex = length(StimuIntDefs);</span>
1473 <span class="comment">%             outputFolder= subject.OutputDirectory;</span>
1474 <span class="comment">%             h = waitbar(0,['Writing EEG quality figures for ' num2str(StimuIntIndex) ' StimulusInterval(s)']);</span>
1475 <span class="comment">%             xtick = 0:numSubjects;</span>
1476 <span class="comment">%             for i = 1:StimuIntIndex</span>
1477 <span class="comment">%                 fig = figure('Visible','off');</span>
1478 <span class="comment">%                 numberExcluded = length(find(filteredQuality(:,i) &gt;= config.QualityIndex));</span>
1479 <span class="comment">%                 plot(unfilteredQuality(:,i),'b');</span>
1480 <span class="comment">%                 hold on;</span>
1481 <span class="comment">%                 plot(filteredQuality(:,i),'k');</span>
1482 <span class="comment">%                 grid;</span>
1483 <span class="comment">%                 hold off;</span>
1484 <span class="comment">%                 line('XData',[1 numSubjects],'YData',[config.QualityIndex config.QualityIndex],'Color','r')</span>
1485 <span class="comment">%                 hold off;</span>
1486 <span class="comment">%                 legend('Unfiltered EEG Data','Filtered EEG Data',[num2str(config.QualityIndex) '% cutoff for filtered EEG data']);</span>
1487 <span class="comment">%                 thresholdString = ['[' num2str(config.LowerThreshold) ',' num2str(config.UpperThreshold) ']'];</span>
1488 <span class="comment">%                 StimuIntClass = StimuIntDefs{1,i}(1);</span>
1489 <span class="comment">%                 title (['Quality index (% of data outside ' thresholdString 'uV interval) for EEG data for ',StimuIntClass.stimuIntDescrp,' ',int2str(i),' = ',int2str(numberExcluded),' data sets are excluded']);</span>
1490 <span class="comment">%                 ylabel('Quality index [%]');</span>
1491 <span class="comment">%                 xlabel('subject [#]');</span>
1492 <span class="comment">%                 axis([1 numSubjects 0 100]);</span>
1493 <span class="comment">%                 set(gca,'XTick',xtick,'xTickLabel',xtick);</span>
1494 <span class="comment">%                 set(fig, 'PaperType', 'A4');</span>
1495 <span class="comment">%                 set(fig, 'PaperOrientation', 'portrait');</span>
1496 <span class="comment">%                 set(fig, 'PaperUnits', 'centimeters');</span>
1497 <span class="comment">%                 set(fig, 'PaperPositionMode', 'auto');</span>
1498 <span class="comment">%                 set(fig, 'PaperPosition', [0.2 0.1 20 29 ]);</span>
1499 <span class="comment">%                 print(['-f',int2str(fig.Number)],'-dpdf',[outputFolder,'\EEG Quality ',StimuIntClass.stimuIntDescrp,'.pdf']);</span>
1500 <span class="comment">%                 close(fig);</span>
1501 <span class="comment">%                 waitbar(i/StimuIntIndex);</span>
1502 <span class="comment">%             end</span>
1503 <span class="comment">%             fig = figure('Visible','off');</span>
1504 <span class="comment">%             ytick = 0:StimuIntIndex;</span>
1505 <span class="comment">%             xtick = 0:numSubjects;</span>
1506 <span class="comment">%             bar(validStimuIntsPerSubject,'stack');</span>
1507 <span class="comment">%             grid on;</span>
1508 <span class="comment">%             legend('Baseline','TV commercial','TV program');</span>
1509 <span class="comment">%             [~,y] = size(validStimuIntsPerSubject);</span>
1510 <span class="comment">%             axis([0 numSubjects+1 0 y+1]);</span>
1511 <span class="comment">%             set(gca,'YTick',ytick,'yTickLabel',ytick);</span>
1512 <span class="comment">%             set(gca,'XTick',xtick,'xTickLabel',xtick);</span>
1513 <span class="comment">%             tMessage = ['Number of subjects reaching EEG quality criteria: ',int2str(validSubjects)];</span>
1514 <span class="comment">%             title(tMessage);</span>
1515 <span class="comment">%             ylabel('Number of StimulusInterval [#]');</span>
1516 <span class="comment">%             xlabel('subject [#]');</span>
1517 <span class="comment">%             set(fig, 'PaperType', 'A4');</span>
1518 <span class="comment">%             set(fig, 'PaperOrientation', 'landscape');</span>
1519 <span class="comment">%             set(fig, 'PaperUnits', 'centimeters');</span>
1520 <span class="comment">%             set(fig, 'PaperPosition', [0.2 0.1 29 20 ]);</span>
1521 <span class="comment">%             print(['-f',int2str(fig.Number)],'-dpdf',[outputFolder,'\EEG Quality Index - Subjects.pdf']);</span>
1522 <span class="comment">%             close(fig)</span>
1523 <span class="comment">%             close(h);</span>
1524 <span class="comment">%         end</span>
1525 
1526         
1527     <span class="keyword">end</span>
1528 <span class="keyword">end</span>
1529</pre></div>
<hr><address>Generated on Tue 12-Jan-2021 15:39:55 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>